<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAC Good Works Assembly - Digital Evangelism Command Center</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            /* Light Theme - Luxury Church Colors */
            --primary-dark: #0d1b3e;
            --primary: #1a237e;
            --primary-light: #303f9f;
            --secondary: #4a148c;
            --secondary-light: #7b1fa2;
            --accent: #ffd700;
            --accent-light: #ffecb3;
            --light: #f8f9fa;
            --light-gray: #e9ecef;
            --medium-gray: #adb5bd;
            --dark: #212529;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            
            /* UI Specific */
            --card-bg: #ffffff;
            --sidebar-bg: #ffffff;
            --header-bg: #ffffff;
            --input-bg: #ffffff;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 15px 50px rgba(0, 0, 0, 0.12);
            --border: #e0e0e0;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-muted: #999999;
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dark-mode {
            --primary-dark: #0a1128;
            --primary: #1a237e;
            --primary-light: #303f9f;
            --secondary: #4a148c;
            --secondary-light: #7b1fa2;
            --accent: #ffd700;
            --accent-light: #ffecb3;
            --light: #121212;
            --light-gray: #1e1e1e;
            --medium-gray: #424242;
            --dark: #f8f9fa;
            --card-bg: #1e1e1e;
            --sidebar-bg: #252525;
            --header-bg: #1a1a1a;
            --input-bg: #2d2d2d;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 15px 50px rgba(0, 0, 0, 0.4);
            --border: #404040;
            --text-primary: #f0f0f0;
            --text-secondary: #cccccc;
            --text-muted: #888888;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', 'Poppins', sans-serif;
            background-color: var(--light);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Login Info Banner */
        .login-info-banner {
            background: linear-gradient(135deg, var(--accent), #ff9800);
            color: var(--primary-dark);
            padding: 12px 20px;
            margin-bottom: 20px;
            border-radius: var(--radius);
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
            text-align: center;
        }

        .login-info-banner i {
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .login-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--radius-sm);
            padding: 15px;
            border-left: 4px solid var(--primary);
        }

        .login-card h4 {
            color: var(--primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .login-card p {
            margin: 5px 0;
            font-size: 0.9rem;
        }

        .login-card .password {
            background: var(--light-gray);
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: 600;
            color: var(--danger);
            margin-top: 5px;
            display: inline-block;
        }

        .scripture-banner {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            text-align: center;
            padding: 12px 20px;
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 1.1rem;
            margin-bottom: 25px;
            border-radius: var(--radius);
            box-shadow: 0 4px 12px rgba(26, 35, 126, 0.2);
            position: relative;
            overflow: hidden;
        }

        .scripture-banner::before {
            content: '"';
            position: absolute;
            font-size: 6rem;
            opacity: 0.1;
            top: -20px;
            left: 20px;
            font-family: 'Playfair Display', serif;
        }

        .scripture-banner::after {
            content: '"';
            position: absolute;
            font-size: 6rem;
            opacity: 0.1;
            bottom: -40px;
            right: 20px;
            font-family: 'Playfair Display', serif;
        }

        /* Main Container */
        .container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: var(--sidebar-bg);
            box-shadow: var(--shadow);
            z-index: 1000;
            transition: var(--transition);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--primary-dark);
            color: white;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent), #ff9800);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-dark);
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .logo-text {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
            white-space: nowrap;
        }

        .logo-subtext {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 400;
        }

        .sidebar.collapsed .logo-text,
        .sidebar.collapsed .logo-subtext {
            display: none;
        }

        .toggle-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .sidebar.collapsed .toggle-btn {
            margin: 0 auto;
        }

        .nav-menu {
            padding: 20px 0;
            flex: 1;
        }

        .nav-item {
            list-style: none;
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            gap: 15px;
            position: relative;
            border-left: 4px solid transparent;
        }

        .nav-link:hover {
            background-color: rgba(0, 0, 0, 0.03);
            color: var(--primary);
            border-left-color: var(--accent);
        }

        .nav-link.active {
            background: linear-gradient(90deg, rgba(26, 35, 126, 0.1), transparent);
            color: var(--primary);
            border-left-color: var(--accent);
            font-weight: 600;
        }

        .nav-link.active::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background-color: var(--accent);
        }

        .nav-icon {
            font-size: 1.2rem;
            min-width: 24px;
            text-align: center;
            color: inherit;
        }

        .nav-text {
            white-space: nowrap;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .sidebar.collapsed .nav-text {
            display: none;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border);
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 20px 30px;
            transition: var(--transition);
            min-height: 100vh;
        }

        .sidebar.collapsed + .main-content {
            margin-left: 80px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
            background-color: var(--header-bg);
            border-radius: var(--radius);
            padding: 20px 30px;
            box-shadow: var(--shadow);
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-title i {
            color: var(--accent);
        }

        .user-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .theme-toggle {
            background: var(--light-gray);
            border: none;
            width: 50px;
            height: 26px;
            border-radius: 50px;
            cursor: pointer;
            position: relative;
            transition: var(--transition);
        }

        .theme-toggle::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: white;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .dark-mode .theme-toggle::after {
            transform: translateX(24px);
            background-color: var(--accent);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--text-muted);
            background-color: var(--light-gray);
            padding: 2px 8px;
            border-radius: 20px;
            display: inline-block;
            width: fit-content;
        }

        .logout-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logout-btn:hover {
            background-color: var(--light-gray);
            color: var(--danger);
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .card-icon {
            width: 70px;
            height: 70px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: white;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .card-icon.souls {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }

        .card-icon.outreaches {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
        }

        .card-icon.converts {
            background: linear-gradient(135deg, #FF9800, #E65100);
        }

        .card-icon.followups {
            background: linear-gradient(135deg, #9C27B0, #6A1B9A);
        }

        .card-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
        }

        .card-label {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .card-trend {
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .card-trend.positive {
            color: var(--success);
        }

        .card-trend.negative {
            color: var(--danger);
        }

        /* Charts Container */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .chart-card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-actions {
            display: flex;
            gap: 10px;
        }

        /* Forms */
        .form-container {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            max-width: 1000px;
            margin: 0 auto;
            border: 1px solid var(--border);
        }

        .form-title {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--text-primary);
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-title i {
            color: var(--accent);
        }

        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            background-color: rgba(0, 0, 0, 0.02);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--primary);
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .form-label.required::after {
            content: ' *';
            color: var(--danger);
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background-color: var(--input-bg);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
        }

        .form-control:disabled {
            background-color: var(--light-gray);
            cursor: not-allowed;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .form-text {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 6px;
        }

        /* Buttons */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(26, 35, 126, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(26, 35, 126, 0.4);
        }

        .btn-secondary {
            background-color: var(--light-gray);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background-color: var(--border);
        }

        .btn-accent {
            background-color: var(--accent);
            color: #333;
            font-weight: 600;
        }

        .btn-accent:hover {
            background-color: #ffc400;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Tables */
        .table-container {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            overflow-x: auto;
            border: 1px solid var(--border);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .data-table th {
            background-color: rgba(0, 0, 0, 0.03);
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border);
            white-space: nowrap;
        }

        .data-table td {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
            vertical-align: middle;
        }

        .data-table tr:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* Status Badges */
        .status-badge {
            padding: 6px 14px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            text-align: center;
            min-width: 100px;
        }

        .status-pending {
            background-color: rgba(255, 193, 7, 0.15);
            color: #b38b00;
        }

        .status-contacted {
            background-color: rgba(40, 167, 69, 0.15);
            color: var(--success);
        }

        .status-not-reached {
            background-color: rgba(220, 53, 69, 0.15);
            color: var(--danger);
        }

        .status-attending {
            background-color: rgba(33, 150, 243, 0.15);
            color: #0d47a1;
        }

        .status-counseling {
            background-color: rgba(156, 39, 176, 0.15);
            color: var(--secondary);
        }

        .status-integrated {
            background-color: rgba(255, 215, 0, 0.15);
            color: #b38b00;
        }

        /* Tabs */
        .tab-nav {
            display: flex;
            border-bottom: 2px solid var(--border);
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 15px 25px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover {
            color: var(--primary);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom: 3px solid var(--accent);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary));
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><path fill="%23ffffff10" d="M0,0l1000,0l0,1000l-1000,0l0,-1000z" /></svg>');
            background-size: cover;
            opacity: 0.1;
        }

        .login-card {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 50px;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
            z-index: 1;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--accent), #ff9800);
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--accent), #ff9800);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            color: var(--primary-dark);
            font-size: 2.5rem;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }

        .login-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Alerts */
        .alert {
            padding: 16px 20px;
            border-radius: var(--radius-sm);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid transparent;
        }

        .alert-success {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success);
            border-left-color: var(--success);
        }

        .alert-error {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger);
            border-left-color: var(--danger);
        }

        .alert-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: #b38b00;
            border-left-color: #ffc107;
        }

        .alert-info {
            background-color: rgba(23, 162, 184, 0.1);
            color: var(--info);
            border-left-color: var(--info);
        }

        /* Heat Map */
        .heat-map-container {
            height: 400px;
            background-color: var(--light-gray);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }

        #heatMap {
            width: 100%;
            height: 100%;
        }

        /* Convert Lifecycle */
        .convert-lifecycle {
            display: flex;
            justify-content: space-between;
            margin: 40px 0;
            position: relative;
        }

        .convert-lifecycle::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 10%;
            right: 10%;
            height: 3px;
            background-color: var(--border);
            z-index: 1;
        }

        .lifecycle-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
            position: relative;
            flex: 1;
        }

        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--card-bg);
            border: 3px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 15px;
            transition: var(--transition);
            color: var(--text-secondary);
        }

        .lifecycle-step.active .step-circle {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 6px 15px rgba(26, 35, 126, 0.3);
        }

        .lifecycle-step.completed .step-circle {
            background-color: var(--success);
            color: white;
            border-color: var(--success);
        }

        .step-label {
            font-size: 0.85rem;
            text-align: center;
            color: var(--text-secondary);
            font-weight: 500;
            max-width: 100px;
        }

        .lifecycle-step.active .step-label {
            color: var(--primary);
            font-weight: 600;
        }

        .lifecycle-step.completed .step-label {
            color: var(--success);
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                z-index: 1001;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0 !important;
                padding: 20px;
            }
            
            .sidebar-toggle {
                display: block !important;
            }
        }

        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .user-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
        }

        @media (max-width: 576px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .login-card {
                padding: 30px 20px;
            }
            
            .tab-nav {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .tab-btn {
                padding: 12px 16px;
                font-size: 0.9rem;
            }
        }

        /* Mobile Sidebar Toggle */
        .sidebar-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
        }

        .sidebar-toggle:hover {
            background: var(--primary-light);
            transform: scale(1.05);
        }

        /* Offline Indicator */
        .offline-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--warning);
            color: #333;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 999;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Page Content */
        .page-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page-content.active {
            display: block;
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background-color: rgba(0, 0, 0, 0.02);
        }

        .file-upload:hover {
            border-color: var(--primary);
            background-color: rgba(26, 35, 126, 0.05);
        }

        .file-upload i {
            font-size: 3rem;
            color: var(--text-muted);
            margin-bottom: 15px;
        }

        /* Custom Checkbox */
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            user-select: none;
        }

        .checkbox-container input {
            display: none;
        }

        .checkbox-checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .checkbox-container input:checked + .checkbox-checkmark {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .checkbox-container input:checked + .checkbox-checkmark::after {
            content: '✓';
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
        }

        /* Custom Select */
        .select-container {
            position: relative;
        }

        .select-container select {
            appearance: none;
            padding-right: 40px;
        }

        .select-container::after {
            content: '▾';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
            font-size: 1.2rem;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark);
            color: white;
            text-align: center;
            border-radius: var(--radius-sm);
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: 400;
        }

        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--dark) transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Quick Login Demo */
        .quick-login-demo {
            margin-top: 25px;
            padding: 20px;
            background: rgba(26, 35, 126, 0.05);
            border-radius: var(--radius);
            border-left: 4px solid var(--accent);
        }

        .quick-login-demo h4 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .demo-credentials {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .demo-credential {
            background: white;
            padding: 15px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }

        .demo-credential h5 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .demo-credential p {
            margin: 5px 0;
            font-size: 0.85rem;
        }

        .demo-credential .password {
            background: var(--light-gray);
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: 600;
            color: var(--danger);
            margin-top: 5px;
            display: inline-block;
        }

        .quick-fill-btn {
            margin-top: 10px;
            padding: 8px 15px;
            background: var(--accent);
            color: #333;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: var(--transition);
        }

        .quick-fill-btn:hover {
            background: #ffc400;
        }

        /* Print Styles */
        @media print {
            .sidebar, .header, .btn, .tab-nav, .chart-actions {
                display: none !important;
            }
            
            .main-content {
                margin-left: 0 !important;
                padding: 0 !important;
            }
            
            .card, .table-container, .form-container {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-church"></i>
                </div>
                <h1 class="login-title">CAC Good Works Assembly</h1>
                <p class="login-subtitle">Digital Evangelism Command Center</p>
                <div class="scripture-banner" style="background: rgba(255, 255, 255, 0.1); margin-top: 20px;">
                    "Therefore go and make disciples of all nations..." - Matthew 28:19
                </div>
            </div>
            
            <!-- Login Information Banner -->
            <div class="login-info-banner">
                <i class="fas fa-key"></i> DEFAULT LOGIN CREDENTIALS - Use any of these to test the system
            </div>
            
            <!-- Quick Login Demo Section -->
            <div class="quick-login-demo">
                <h4><i class="fas fa-users"></i> Test User Accounts</h4>
                <div class="demo-credentials">
                    <div class="demo-credential">
                        <h5><i class="fas fa-user-shield"></i> Administrator</h5>
                        <p><strong>Email:</strong> admin@cacgoodworks.org</p>
                        <p><strong>Password:</strong> <span class="password">Admin@2023</span></p>
                        <p><strong>Role:</strong> Full System Access</p>
                        <button class="quick-fill-btn" data-email="admin@cacgoodworks.org" data-password="Admin@2023" data-role="admin">
                            <i class="fas fa-bolt"></i> Quick Login
                        </button>
                    </div>
                    <div class="demo-credential">
                        <h5><i class="fas fa-user-check"></i> Evangelist (Team Leader)</h5>
                        <p><strong>Email:</strong> pastor.james@cacgoodworks.org</p>
                        <p><strong>Password:</strong> <span class="password">Pastor@2023</span></p>
                        <p><strong>Role:</strong> Evangelist + Team Management</p>
                        <button class="quick-fill-btn" data-email="pastor.james@cacgoodworks.org" data-password="Pastor@2023" data-role="evangelist">
                            <i class="fas fa-bolt"></i> Quick Login
                        </button>
                    </div>
                    <div class="demo-credential">
                        <h5><i class="fas fa-user"></i> Regular Evangelist</h5>
                        <p><strong>Email:</strong> evangelist@cacgoodworks.org</p>
                        <p><strong>Password:</strong> <span class="password">Evangelist@2023</span></p>
                        <p><strong>Role:</strong> Evangelist (Standard)</p>
                        <button class="quick-fill-btn" data-email="evangelist@cacgoodworks.org" data-password="Evangelist@2023" data-role="evangelist">
                            <i class="fas fa-bolt"></i> Quick Login
                        </button>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: var(--radius-sm);">
                    <h5 style="color: var(--primary); margin-bottom: 10px;"><i class="fas fa-lightbulb"></i> Testing Tips:</h5>
                    <ul style="padding-left: 20px; font-size: 0.85rem; color: var(--text-secondary);">
                        <li>Try both <strong>Admin</strong> and <strong>Evangelist</strong> roles to see different permissions</li>
                        <li>Admin can access all features including Audit Logs and System Settings</li>
                        <li>Evangelists can only submit reports and view their own data</li>
                        <li>Test the offline mode by disconnecting internet while filling forms</li>
                    </ul>
                </div>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label required" for="loginEmail">Email Address</label>
                    <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label required" for="loginPassword">Password</label>
                    <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required>
                    <div class="form-text">
                        <a href="#" id="forgotPasswordLink" style="color: var(--primary); text-decoration: none;">Forgot Password?</a>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label required" for="loginRole">Select Role</label>
                    <select class="form-control" id="loginRole" required>
                        <option value="">-- Select Role --</option>
                        <option value="admin">Admin (Church Leadership)</option>
                        <option value="evangelist">Evangelist</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <div class="checkbox-container" style="margin-bottom: 15px;">
                        <input type="checkbox" id="rememberMe">
                        <span class="checkbox-checkmark"></span>
                        <label for="rememberMe">Remember me</label>
                    </div>
                    
                    <div class="checkbox-container">
                        <input type="checkbox" id="twoFactor">
                        <span class="checkbox-checkmark"></span>
                        <label for="twoFactor">Enable Two-Factor Authentication</label>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-sign-in-alt"></i> Login to System
                </button>
                
                <div class="alert" id="loginAlert" style="display: none; margin-top: 20px;"></div>
                
                <div style="text-align: center; margin-top: 25px; color: var(--text-muted); font-size: 0.9rem;">
                    <p>Next-Generation Evangelism Tracking System</p>
                    <p style="margin-top: 5px;">Version 2.0 • Secure • Cloud-Based</p>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appContainer" style="display: none;">
        <!-- Mobile Sidebar Toggle -->
        <button class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <div class="logo-icon">
                        <i class="fas fa-cross"></i>
                    </div>
                    <div>
                        <div class="logo-text">CAC Good Works</div>
                        <div class="logo-subtext">Evangelism Tracking</div>
                    </div>
                </div>
                <button class="toggle-btn" id="collapseToggle">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-page="dashboard">
                        <i class="nav-icon fas fa-tachometer-alt"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="report">
                        <i class="nav-icon fas fa-plus-circle"></i>
                        <span class="nav-text">New Evangelism Report</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="converts">
                        <i class="nav-icon fas fa-user-friends"></i>
                        <span class="nav-text">Converts Management</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="followups">
                        <i class="nav-icon fas fa-bell"></i>
                        <span class="nav-text">Follow-up System</span>
                        <span class="badge" id="followupBadge" style="background: var(--danger); color: white; border-radius: 10px; padding: 2px 8px; font-size: 0.7rem; margin-left: auto;">3</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="analytics">
                        <i class="nav-icon fas fa-chart-bar"></i>
                        <span class="nav-text">Analytics & Insights</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="reports">
                        <i class="nav-icon fas fa-file-export"></i>
                        <span class="nav-text">Report Generator</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="heatmap">
                        <i class="nav-icon fas fa-map-marked-alt"></i>
                        <span class="nav-text">Evangelism Heat Map</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="settings">
                        <i class="nav-icon fas fa-cog"></i>
                        <span class="nav-text">System Settings</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="audit">
                        <i class="nav-icon fas fa-shield-alt"></i>
                        <span class="nav-text">Audit Logs</span>
                    </a>
                </li>
            </ul>
            
            <div class="sidebar-footer">
                <div id="syncStatus" style="margin-bottom: 10px;">
                    <i class="fas fa-cloud" style="color: var(--success);"></i>
                    <span>All systems synced</span>
                </div>
                <div>© 2026 CAC Good Works Assembly</div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1 class="page-title">
                    <i class="fas fa-tachometer-alt"></i>
                    <span id="pageTitle">Evangelism Dashboard</span>
                </h1>
                <div class="user-controls">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div id="offlineIndicator" class="offline-indicator" style="display: none;">
                            <i class="fas fa-wifi-slash"></i>
                            <span>Working Offline</span>
                        </div>
                        <button class="theme-toggle" id="themeToggle"></button>
                        <div class="user-profile">
                            <div class="user-avatar" id="userAvatar">AA</div>
                            <div class="user-info">
                                <div class="user-name" id="userName">Pastor Akin</div>
                                <div class="user-role" id="userRole">Administrator</div>
                            </div>
                        </div>
                        <button class="logout-btn" id="logoutBtn" title="Logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Scripture Banner -->
            <div class="scripture-banner" id="scriptureBanner">
                "The fruit of the righteous is a tree of life, and he who wins souls is wise." - Proverbs 11:30
            </div>
            
            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page-content active">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-icon souls">
                            <i class="fas fa-praying-hands"></i>
                        </div>
                        <div class="card-value" id="totalSouls">1,847</div>
                        <div class="card-label">Total Souls Reached</div>
                        <div class="card-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>12% increase this month</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-icon outreaches">
                            <i class="fas fa-church"></i>
                        </div>
                        <div class="card-value" id="totalOutreaches">127</div>
                        <div class="card-label">Outreaches Conducted</div>
                        <div class="card-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>8% increase this month</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-icon converts">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="card-value" id="totalConverts">524</div>
                        <div class="card-label">Decisions for Christ</div>
                        <div class="card-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>15% increase this month</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-icon followups">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="card-value" id="activeFollowups">67</div>
                        <div class="card-label">Active Follow-ups</div>
                        <div class="card-trend negative">
                            <i class="fas fa-arrow-down"></i>
                            <span>3 overdue follow-ups</span>
                        </div>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Monthly Evangelism Trends</h3>
                            <div class="chart-actions">
                                <select class="form-control" style="width: auto; padding: 8px 12px;">
                                    <option>Last 6 months</option>
                                    <option>Last year</option>
                                    <option>All time</option>
                                </select>
                            </div>
                        </div>
                        <canvas id="monthlyTrendsChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Outreach Effectiveness</h3>
                            <div class="chart-actions">
                                <button class="btn btn-sm btn-secondary">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <canvas id="outreachTypesChart"></canvas>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Recent Evangelism Reports</h3>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-primary" onclick="navigateToPage('report')">
                                <i class="fas fa-plus"></i> New Report
                            </button>
                            <button class="btn btn-sm btn-secondary">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Evangelist</th>
                                <th>Location</th>
                                <th>Type</th>
                                <th>Souls Reached</th>
                                <th>Decisions</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recentReportsTable">
                            <!-- Dynamic content will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- New Report Page -->
            <div id="reportPage" class="page-content">
                <div class="form-container">
                    <h2 class="form-title">
                        <i class="fas fa-plus-circle"></i> New Evangelism Report
                    </h2>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <span>This form supports offline mode. Data will sync automatically when you're back online.</span>
                    </div>
                    
                    <form id="evangelismForm">
                        <!-- Section 1: Basic Information -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-info-circle"></i> Outreach Information
                            </h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label required" for="evangelistName">Evangelist Name</label>
                                    <input type="text" class="form-control" id="evangelistName" placeholder="Enter evangelist name" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="team">Team</label>
                                    <div class="select-container">
                                        <select class="form-control" id="team">
                                            <option value="">Select Team</option>
                                            <option value="alpha">Group 1</option>
                                            <option value="beta">Group 2</option>
                                            <option value="gamma">Group 3</option>
                                            <option value="delta">Group 4</option>
                                            <option value="zeta">Group 5</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label required" for="outreachDate">Date of Outreach</label>
                                    <input type="date" class="form-control" id="outreachDate" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label required" for="location">Location</label>
                                    <input type="text" class="form-control" id="location" placeholder="Enter location of outreach" required>
                                    <div class="form-text">
                                        <button type="button" class="btn btn-sm" style="padding: 0; color: var(--primary);" id="getLocationBtn">
                                            <i class="fas fa-map-marker-alt"></i> Use current location
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required" for="outreachType">Type of Evangelism</label>
                                <div class="select-container">
                                    <select class="form-control" id="outreachType" required>
                                        <option value="">Select Type</option>
                                        <option value="street">Street Evangelism</option>
                                        <option value="crusade">Crusade/Revival</option>
                                        <option value="house">House-to-House</option>
                                        <option value="school">School Outreach</option>
                                        <option value="online">Online Evangelism</option>
                                        <option value="hospital">Hospital Ministry</option>
                                        <option value="prison">Prison Ministry</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section 2: Results -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-chart-line"></i> Outreach Results
                            </h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label required" for="soulsReached">Souls Reached</label>
                                    <input type="number" class="form-control" id="soulsReached" placeholder="Number of souls reached" required min="0">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label required" for="decisions">Decisions for Christ</label>
                                    <input type="number" class="form-control" id="decisions" placeholder="Number of decisions" required min="0">
                                    <div class="form-text">Number of people who made a decision to follow Christ</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="notes">Notes & Testimonies</label>
                                <textarea class="form-control" id="notes" rows="4" placeholder="Share any notable testimonies, observations, prayer points, or additional notes"></textarea>
                                <div class="form-text">You can also record audio testimonies in the mobile app</div>
                            </div>
                        </div>
                        
                        <!-- Section 3: Convert Details -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-user-plus"></i> Convert Details (Optional)
                            </h3>
                            <p style="margin-bottom: 20px; color: var(--text-secondary);">Add details for individual converts (you can add multiple converts later)</p>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="convertName">Full Name</label>
                                    <input type="text" class="form-control" id="convertName" placeholder="Convert's full name">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="convertPhone">Phone Number</label>
                                    <input type="tel" class="form-control" id="convertPhone" placeholder="Phone number">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="convertGender">Gender</label>
                                    <div class="select-container">
                                        <select class="form-control" id="convertGender">
                                            <option value="">Select Gender</option>
                                            <option value="male">Male</option>
                                            <option value="female">Female</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="convertAge">Age Range</label>
                                    <div class="select-container">
                                        <select class="form-control" id="convertAge">
                                            <option value="">Select Age Range</option>
                                            <option value="child">Child (0-12)</option>
                                            <option value="teen">Teen (13-19)</option>
                                            <option value="young-adult">Young Adult (20-35)</option>
                                            <option value="adult">Adult (36-59)</option>
                                            <option value="senior">Senior (60+)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="convertAddress">Address/Location</label>
                                    <input type="text" class="form-control" id="convertAddress" placeholder="Address or location">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="followupWorker">Assigned Follow-up Worker</label>
                                    <div class="select-container">
                                        <select class="form-control" id="followupWorker">
                                            <option value="">Select Worker</option>
                                            <option value="john">Brother Moses</option>
                                            <option value="jane">Brother Korede</option>
                                            <option value="david">Brother Tolu</option>
                                            <option value="sarah">Sister Shade</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="prayerNeeds">Prayer Needs</label>
                                <textarea class="form-control" id="prayerNeeds" rows="3" placeholder="Any specific prayer requests or needs"></textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="checkbox-container">
                                        <input type="checkbox" id="whatsappAvailable">
                                        <span class="checkbox-checkmark"></span>
                                        <label for="whatsappAvailable">Has WhatsApp</label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="checkbox-container">
                                        <input type="checkbox" id="needsCounseling">
                                        <span class="checkbox-checkmark"></span>
                                        <label for="needsCounseling">Needs Counseling</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap;">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Report
                            </button>
                            <button type="button" class="btn btn-secondary" id="saveDraftBtn">
                                <i class="fas fa-file-alt"></i> Save as Draft
                            </button>
                            <button type="button" class="btn btn-secondary" id="clearFormBtn">
                                <i class="fas fa-times"></i> Clear Form
                            </button>
                            <button type="button" class="btn btn-accent" id="addAnotherConvertBtn">
                                <i class="fas fa-user-plus"></i> Add Another Convert
                            </button>
                        </div>
                        
                        <div class="alert" id="formAlert" style="display: none; margin-top: 20px;"></div>
                    </form>
                </div>
            </div>
            
            <!-- Converts Page -->
            <div id="convertsPage" class="page-content">
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Convert Management System</h3>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-primary" id="addConvertBtn">
                                <i class="fas fa-user-plus"></i> Add Convert
                            </button>
                            <button class="btn btn-sm btn-secondary" id="importConvertsBtn">
                                <i class="fas fa-file-import"></i> Import
                            </button>
                            <button class="btn btn-sm btn-success" id="exportConvertsBtn">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="allConverts">
                            <i class="fas fa-users"></i> All Converts
                        </button>
                        <button class="tab-btn" data-tab="needsFollowup">
                            <i class="fas fa-bell"></i> Needs Follow-up
                            <span class="badge" style="background: var(--danger); color: white; border-radius: 10px; padding: 2px 8px; font-size: 0.7rem; margin-left: 5px;">12</span>
                        </button>
                        <button class="tab-btn" data-tab="attendingChurch">
                            <i class="fas fa-church"></i> Attending Church
                        </button>
                        <button class="tab-btn" data-tab="needsCounseling">
                            <i class="fas fa-hands-helping"></i> Needs Counseling
                        </button>
                        <button class="tab-btn" data-tab="integrated">
                            <i class="fas fa-check-circle"></i> Integrated
                        </button>
                    </div>
                    
                    <div class="tab-content active" id="allConverts">
                        <div style="margin-bottom: 20px;">
                            <div class="form-row" style="grid-template-columns: 2fr 1fr 1fr auto;">
                                <div class="form-group">
                                    <input type="text" class="form-control" placeholder="Search converts...">
                                </div>
                                <div class="form-group">
                                    <select class="form-control">
                                        <option>All Groups</option>
                                        <option>Group 1</option>
                                        <option>Group 2</option>
                                        <option>Group 3</option>
                                        <option>Group 4</option>
                                        <option>Group 5</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <select class="form-control">
                                        <option>All Status</option>
                                        <option>Contacted</option>
                                        <option>Not Reached</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <button class="btn btn-primary">
                                        <i class="fas fa-search"></i> Search
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Contact</th>
                                    <th>Date Saved</th>
                                    <th>Age/Gender</th>
                                    <th>Follow-up Status</th>
                                    <th>Worker</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="convertsTable">
                                <!-- Dynamic content will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="needsFollowup">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Contact</th>
                                    <th>Date Saved</th>
                                    <th>Days Since</th>
                                    <th>Follow-up Worker</th>
                                    <th>Next Follow-up</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="followupTable">
                                <!-- Dynamic content will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Convert Lifecycle Visualization -->
                <div class="card" style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;">Convert Lifecycle Status</h3>
                    <div class="convert-lifecycle">
                        <div class="lifecycle-step completed">
                            <div class="step-circle">
                                <i class="fas fa-handshake"></i>
                            </div>
                            <div class="step-label">Initial Contact</div>
                        </div>
                        <div class="lifecycle-step active">
                            <div class="step-circle">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div class="step-label">Follow-up</div>
                        </div>
                        <div class="lifecycle-step">
                            <div class="step-circle">
                                <i class="fas fa-church"></i>
                            </div>
                            <div class="step-label">Attending Church</div>
                        </div>
                        <div class="lifecycle-step">
                            <div class="step-circle">
                                <i class="fas fa-hands-helping"></i>
                            </div>
                            <div class="step-label">Discipleship</div>
                        </div>
                        <div class="lifecycle-step">
                            <div class="step-circle">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="step-label">Integrated</div>
                        </div>
                    </div>
                </div>
                
                <!-- Testimony Upload -->
                <div class="card" style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;">Convert Testimonies</h3>
                    <div class="file-upload" id="testimonyUpload">
                        <i class="fas fa-microphone-alt"></i>
                        <p>Click to upload testimony (text or audio)</p>
                        <p style="font-size: 0.9rem; color: var(--text-muted); margin-top: 10px;">Supports .txt, .mp3, .wav formats</p>
                    </div>
                    <div id="uploadedTestimonies" style="margin-top: 20px;">
                        <!-- Uploaded testimonies will appear here -->
                    </div>
                </div>
            </div>
            
            <!-- Follow-ups Page -->
            <div id="followupsPage" class="page-content">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-icon" style="background: linear-gradient(135deg, #FF5722, #D84315);">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="card-value" id="dueFollowups">15</div>
                        <div class="card-label">Due Today</div>
                        <div class="card-trend negative">
                            <i class="fas fa-clock"></i>
                            <span>3 overdue</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-icon" style="background: linear-gradient(135deg, #FF9800, #EF6C00);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="card-value" id="upcomingFollowups">28</div>
                        <div class="card-label">Upcoming</div>
                        <div class="card-trend positive">
                            <i class="fas fa-calendar-check"></i>
                            <span>Next 7 days</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-icon" style="background: linear-gradient(135deg, #4CAF50, #2E7D32);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="card-value" id="completedFollowups">189</div>
                        <div class="card-label">Completed</div>
                        <div class="card-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>24 this week</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-icon" style="background: linear-gradient(135deg, #9C27B0, #6A1B9A);">
                            <i class="fas fa-comment-alt"></i>
                        </div>
                        <div class="card-value" id="pendingMessages">9</div>
                        <div class="card-label">Pending Messages</div>
                        <div class="card-trend negative">
                            <i class="fas fa-envelope"></i>
                            <span>Awaiting response</span>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Follow-up Schedule</h3>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-primary" id="autoScheduleBtn">
                                <i class="fas fa-robot"></i> Auto-schedule
                            </button>
                            <button class="btn btn-sm btn-secondary" id="sendBulkBtn">
                                <i class="fas fa-paper-plane"></i> Send Bulk
                            </button>
                        </div>
                    </div>
                    
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="dueFollowupsTab">Due Today</button>
                        <button class="tab-btn" data-tab="upcomingFollowupsTab">Upcoming</button>
                        <button class="tab-btn" data-tab="completedFollowupsTab">Completed</button>
                        <button class="tab-btn" data-tab="customScheduleTab">Custom Schedule</button>
                    </div>
                    
                    <div class="tab-content active" id="dueFollowupsTab">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Convert Name</th>
                                    <th>Contact</th>
                                    <th>Follow-up Date</th>
                                    <th>Method</th>
                                    <th>Status</th>
                                    <th>Worker</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="followupScheduleTable">
                                <!-- Dynamic content will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Automated Follow-up System -->
                <div class="card" style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;">Automated Follow-up System</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="followupRecipient">Recipient</label>
                            <div class="select-container">
                                <select class="form-control" id="followupRecipient">
                                    <option value="">Select Convert</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="followupMethod">Method</label>
                            <div class="select-container">
                                <select class="form-control" id="followupMethod">
                                    <option value="whatsapp">WhatsApp</option>
                                    <option value="sms">SMS</option>
                                    <option value="call">Phone Call</option>
                                    <option value="email">Email</option>
                                    <option value="all">All Methods</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="followupInterval">Interval</label>
                            <div class="select-container">
                                <select class="form-control" id="followupInterval">
                                    <option value="24">24 hours</option>
                                    <option value="72">3 days</option>
                                    <option value="168">7 days</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="followupMessage">Message Template</label>
                        <textarea class="form-control" id="followupMessage" rows="3" placeholder="Enter follow-up message..."></textarea>
                        <div class="form-text">
                            Use {name} for convert's name, {date} for salvation date
                        </div>
                    </div>
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-primary" id="sendFollowupBtn">
                            <i class="fas fa-paper-plane"></i> Send Follow-up
                        </button>
                        <button class="btn btn-secondary" id="scheduleFollowupBtn">
                            <i class="fas fa-calendar-plus"></i> Schedule
                        </button>
                        <button class="btn btn-accent" id="testFollowupBtn">
                            <i class="fas fa-vial"></i> Test
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Analytics Page -->
            <div id="analyticsPage" class="page-content">
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Growth Trends (Last 12 Months)</h3>
                            <div class="chart-actions">
                                <select class="form-control" style="width: auto; padding: 8px 12px;">
                                    <option>Monthly</option>
                                    <option>Weekly</option>
                                    <option>Daily</option>
                                </select>
                            </div>
                        </div>
                        <canvas id="growthTrendsChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Conversion Rates by Outreach Type</h3>
                            <div class="chart-actions">
                                <button class="btn btn-sm btn-secondary">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <canvas id="conversionRatesChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card" style="margin-bottom: 30px;">
                    <div class="chart-header">
                        <h3 class="chart-title">Top Evangelists Performance</h3>
                        <div class="chart-actions">
                            <select class="form-control" style="width: auto; padding: 8px 12px;">
                                <option>Last 30 days</option>
                                <option>Last quarter</option>
                                <option>This year</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="topEvangelistsChart"></canvas>
                </div>
                
                <div class="card" style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px;">Evangelism Effectiveness Analytics</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <div class="card" style="padding: 20px; text-align: center;">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--primary);">42%</div>
                                <div style="color: var(--text-secondary);">Overall Conversion Rate</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="card" style="padding: 20px; text-align: center;">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--success);">68%</div>
                                <div style="color: var(--text-secondary);">Follow-up Success Rate</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="card" style="padding: 20px; text-align: center;">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--accent);">15.4</div>
                                <div style="color: var(--text-secondary);">Avg. Souls per Outreach</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Heat Map Page -->
            <div id="heatmapPage" class="page-content">
                <div class="card">
                    <div class="chart-header">
                        <h3 class="chart-title">Evangelism Heat Map</h3>
                        <div class="chart-actions">
                            <select class="form-control" style="width: auto; padding: 8px 12px;">
                                <option>Last 30 days</option>
                                <option>Last 3 months</option>
                                <option>This year</option>
                                <option>All time</option>
                            </select>
                        </div>
                    </div>
                    <div class="heat-map-container">
                        <div id="heatMap"></div>
                    </div>
                    <div style="margin-top: 20px; color: var(--text-secondary);">
                        <p><i class="fas fa-info-circle" style="color: var(--primary);"></i> This heat map shows evangelism activity density across locations. Darker areas indicate higher activity.</p>
                    </div>
                </div>
                
                <div class="charts-container" style="margin-top: 30px;">
                    <div class="chart-card">
                        <h3 class="chart-title">Top Outreach Locations</h3>
                        <canvas id="locationsChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3 class="chart-title">Effectiveness by Region</h3>
                        <canvas id="regionEffectivenessChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Reports Page -->
            <div id="reportsPage" class="page-content">
                <div class="form-container">
                    <h2 class="form-title">
                        <i class="fas fa-file-export"></i> Report Generator
                    </h2>
                    
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-cog"></i> Report Configuration
                        </h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="reportType">Report Type</label>
                                <div class="select-container">
                                    <select class="form-control" id="reportType">
                                        <option value="summary">Summary Report</option>
                                        <option value="detailed">Detailed Evangelism Report</option>
                                        <option value="followup">Follow-up Status Report</option>
                                        <option value="converts">Convert Lifecycle Report</option>
                                        <option value="performance">Evangelist Performance Report</option>
                                        <option value="monthly">Monthly Summary Report</option>
                                        <option value="custom">Custom Report</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="dateRange">Date Range</label>
                                <div class="select-container">
                                    <select class="form-control" id="dateRange">
                                        <option value="last7">Last 7 Days</option>
                                        <option value="last30">Last 30 Days</option>
                                        <option value="last90">Last 90 Days</option>
                                        <option value="month">This Month</option>
                                        <option value="quarter">This Quarter</option>
                                        <option value="year">This Year</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row" id="customDateRange" style="display: none;">
                            <div class="form-group">
                                <label class="form-label" for="startDate">Start Date</label>
                                <input type="date" class="form-control" id="startDate">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="endDate">End Date</label>
                                <input type="date" class="form-control" id="endDate">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="reportEvangelist">Filter by Evangelist</label>
                                <div class="select-container">
                                    <select class="form-control" id="reportEvangelist">
                                        <option value="">All Evangelists</option>
                                        <option value="john">Brother Moses</option>
                                        <option value="jane">Ayaba</option>
                                        <option value="david">Sister Shade</option>
                                        <option value="sarah">Brother Tolu</option>
                                         <option value="david">Brother Korede</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="reportTeam">Filter by Team</label>
                                <div class="select-container">
                                    <select class="form-control" id="reportTeam">
                                        <option value="">All Teams</option>
                                        <option value="alpha">Group 1</option>
                                        <option value="beta">Group 2</option>
                                        <option value="gamma">Group 3</option>
                                        <option value="gamma">Group 4</option>
                                        <option value="gamma">Group 5</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="reportFormat">Export Format</label>
                                <div class="select-container">
                                    <select class="form-control" id="reportFormat">
                                        <option value="pdf">PDF Document</option>
                                        <option value="excel">Excel Spreadsheet</option>
                                        <option value="csv">CSV File</option>
                                        <option value="html">HTML Report</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="reportTemplate">Report Template</label>
                                <div class="select-container">
                                    <select class="form-control" id="reportTemplate">
                                        <option value="standard">Standard Church Format</option>
                                        <option value="detailed">Detailed Analysis</option>
                                        <option value="executive">Executive Summary</option>
                                        <option value="presentation">Presentation Ready</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Include Sections</label>
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="checkbox-container">
                                        <input type="checkbox" id="includeCharts" checked>
                                        <span class="checkbox-checkmark"></span>
                                        <label for="includeCharts">Charts & Graphs</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="checkbox-container">
                                        <input type="checkbox" id="includeTables" checked>
                                        <span class="checkbox-checkmark"></span>
                                        <label for="includeTables">Data Tables</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="checkbox-container">
                                        <input type="checkbox" id="includeTestimonies">
                                        <span class="checkbox-checkmark"></span>
                                        <label for="includeTestimonies">Testimonies</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="checkbox-container">
                                        <input type="checkbox" id="includeRecommendations" checked>
                                        <span class="checkbox-checkmark"></span>
                                        <label for="includeRecommendations">Recommendations</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap;">
                        <button class="btn btn-primary" id="generateReportBtn">
                            <i class="fas fa-file-export"></i> Generate Report
                        </button>
                        <button class="btn btn-accent" id="previewReportBtn">
                            <i class="fas fa-eye"></i> Preview Report
                        </button>
                        <button class="btn btn-secondary" id="saveTemplateBtn">
                            <i class="fas fa-save"></i> Save as Template
                        </button>
                        <button class="btn btn-success" id="scheduleReportBtn">
                            <i class="fas fa-calendar-alt"></i> Schedule Auto-report
                        </button>
                    </div>
                    
                    <div id="reportPreview" style="margin-top: 30px; display: none;">
                        <div class="card">
                            <div class="chart-header">
                                <h3 class="chart-title">Report Preview</h3>
                                <div class="chart-actions">
                                    <button class="btn btn-sm btn-primary" id="printPreviewBtn">
                                        <i class="fas fa-print"></i> Print
                                    </button>
                                </div>
                            </div>
                            <div id="previewContent" style="padding: 20px 0;">
                                <!-- Preview content will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert" id="reportAlert" style="display: none; margin-top: 20px;"></div>
                </div>
            </div>
            
            <!-- Settings Page -->
            <div id="settingsPage" class="page-content">
                <div class="form-container">
                    <h2 class="form-title">
                        <i class="fas fa-cog"></i> System Settings
                    </h2>
                    
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="generalSettings">General</button>
                        <button class="tab-btn" data-tab="reminderSettings">Reminders</button>
                        <button class="tab-btn" data-tab="userSettings">Users & Teams</button>
                        <button class="tab-btn" data-tab="integrationSettings">Integrations</button>
                        <button class="tab-btn" data-tab="securitySettings">Security</button>
                        <button class="tab-btn" data-tab="backupSettings">Backup</button>
                    </div>
                    
                    <div class="tab-content active" id="generalSettings">
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-church"></i> Church Information
                            </h3>
                            
                            <div class="form-group">
                                <label class="form-label" for="churchName">Church Name</label>
                                <input type="text" class="form-control" id="churchName" value="CAC Good Works Assembly">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="timezone">Timezone</label>
                                    <div class="select-container">
                                        <select class="form-control" id="timezone">
                                            <option value="GMT+1">West Africa Time (GMT+1)</option>
                                            <option value="GMT">Greenwich Mean Time (GMT)</option>
                                            <option value="GMT-5">Eastern Time (GMT-5)</option>
                                            <option value="GMT+8">Singapore Time (GMT+8)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="dateFormat">Date Format</label>
                                    <div class="select-container">
                                        <select class="form-control" id="dateFormat">
                                            <option value="dd/mm/yyyy">DD/MM/YYYY</option>
                                            <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                                            <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="churchLogo">Church Logo</label>
                                <div class="file-upload" style="padding: 20px;">
                                    <i class="fas fa-upload"></i>
                                    <p>Click to upload church logo</p>
                                    <p style="font-size: 0.9rem; color: var(--text-muted); margin-top: 10px;">Recommended: 300x300px, PNG format</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-bell"></i> Notifications
                            </h3>
                            
                            <div class="form-group">
                                <label class="form-label">Notification Methods</label>
                                <div class="form-row">
                                    <div class="form-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="notifyEmail" checked>
                                            <span class="checkbox-checkmark"></span>
                                            <label for="notifyEmail">Email Notifications</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="notifySMS">
                                            <span class="checkbox-checkmark"></span>
                                            <label for="notifySMS">SMS Notifications</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="notifyPush" checked>
                                            <span class="checkbox-checkmark"></span>
                                            <label for="notifyPush">Push Notifications</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="adminEmail">Admin Email for Reports</label>
                                <input type="email" class="form-control" id="adminEmail" placeholder="admin@cacgoodworks.org">
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" style="margin-top: 20px;">
                            <i class="fas fa-save"></i> Save General Settings
                        </button>
                    </div>
                    
                    <div class="tab-content" id="reminderSettings">
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-clock"></i> Follow-up Reminder Intervals
                            </h3>
                            
                            <div class="form-group">
                                <div class="form-row">
                                    <div class="form-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="reminder24h" checked>
                                            <span class="checkbox-checkmark"></span>
                                            <label for="reminder24h">24 hours after evangelism</label>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="reminder3days" checked>
                                            <span class="checkbox-checkmark"></span>
                                            <label for="reminder3days">3 days after evangelism</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="reminder7days" checked>
                                            <span class="checkbox-checkmark"></span>
                                            <label for="reminder7days">7 days after evangelism</label>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="reminder14days">
                                            <span class="checkbox-checkmark"></span>
                                            <label for="reminder14days">14 days after evangelism</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="reminder30days">
                                            <span class="checkbox-checkmark"></span>
                                            <label for="reminder30days">30 days after evangelism</label>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="reminderCustom">
                                            <span class="checkbox-checkmark"></span>
                                            <label for="reminderCustom">Custom interval:</label>
                                        </div>
                                        <input type="number" style="width: 100px; margin-left: 30px;" class="form-control" id="customDays" placeholder="Days" disabled>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="reminderMethod">Default Reminder Method</label>
                                <div class="select-container">
                                    <select class="form-control" id="reminderMethod">
                                        <option value="whatsapp">WhatsApp</option>
                                        <option value="sms">SMS</option>
                                        <option value="email">Email</option>
                                        <option value="call">Phone Call</option>
                                        <option value="all">All Methods</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="reminderTime">Default Reminder Time</label>
                                <input type="time" class="form-control" id="reminderTime" value="09:00">
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-robot"></i> Automated Follow-up Messages
                            </h3>
                            
                            <div class="form-group">
                                <label class="form-label" for="autoMessage1">24-hour Follow-up Message</label>
                                <textarea class="form-control" id="autoMessage1" rows="3">Hi {name}, this is {church} following up on your decision to follow Christ yesterday. How are you doing? We're praying for you!</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="autoMessage2">7-day Follow-up Message</label>
                                <textarea class="form-control" id="autoMessage2" rows="3">Hello {name}, it's been a week since you made your decision. We hope you're growing in faith. Would you like to join our new believers' class this Sunday?</textarea>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" style="margin-top: 20px;">
                            <i class="fas fa-save"></i> Save Reminder Settings
                        </button>
                    </div>
                    
                    <div class="tab-content" id="securitySettings">
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-shield-alt"></i> Security & Data Protection
                            </h3>
                            
                            <div class="form-group">
                                <div class="checkbox-container">
                                    <input type="checkbox" id="enable2FA">
                                    <span class="checkbox-checkmark"></span>
                                    <label for="enable2FA">Enable Two-Factor Authentication for all users</label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div class="checkbox-container">
                                    <input type="checkbox" id="encryptData" checked>
                                    <span class="checkbox-checkmark"></span>
                                    <label for="encryptData">Encrypt sensitive data (phone numbers, addresses)</label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div class="checkbox-container">
                                    <input type="checkbox" id="auditLogging" checked>
                                    <span class="checkbox-checkmark"></span>
                                    <label for="auditLogging">Enable audit logging (who edited what & when)</label>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="sessionTimeout">Session Timeout (minutes)</label>
                                    <input type="number" class="form-control" id="sessionTimeout" value="30" min="5" max="480">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="passwordPolicy">Password Policy</label>
                                    <div class="select-container">
                                        <select class="form-control" id="passwordPolicy">
                                            <option value="standard">Standard (8+ characters)</option>
                                            <option value="strong">Strong (12+ characters, mixed)</option>
                                            <option value="very-strong">Very Strong (16+ characters, special)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">GDPR Compliance</label>
                                <div class="form-row">
                                    <div class="form-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="gdprConsent" checked>
                                            <span class="checkbox-checkmark"></span>
                                            <label for="gdprConsent">Require consent for data collection</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="checkbox-container">
                                            <input type="checkbox" id="rightToDelete">
                                            <span class="checkbox-checkmark"></span>
                                            <label for="rightToDelete">Allow right to be forgotten</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" style="margin-top: 20px;">
                            <i class="fas fa-save"></i> Save Security Settings
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Audit Logs Page -->
            <div id="auditPage" class="page-content">
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">System Audit Logs</h3>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-secondary" id="exportLogsBtn">
                                <i class="fas fa-download"></i> Export Logs
                            </button>
                            <button class="btn btn-sm btn-danger" id="clearOldLogsBtn">
                                <i class="fas fa-trash"></i> Clear Old Logs
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-row" style="margin-bottom: 20px; grid-template-columns: 1fr 1fr 1fr auto;">
                        <div class="form-group">
                            <select class="form-control">
                                <option>All Actions</option>
                                <option>Create</option>
                                <option>Update</option>
                                <option>Delete</option>
                                <option>Login</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <select class="form-control">
                                <option>All Users</option>
                                <option>Pastor</option>
                                <option>Brother Moses</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <input type="date" class="form-control" placeholder="Date from">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-primary">
                                <i class="fas fa-search"></i> Filter
                            </button>
                        </div>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>Entity</th>
                                <th>Details</th>
                                <th>IP Address</th>
                            </tr>
                        </thead>
                        <tbody id="auditLogsTable">
                            <!-- Dynamic content will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration and Application Logic -->
    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        // Replace with your actual Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC_Example_ReplaceWithYourConfig",
            authDomain: "cac-goodworks.firebaseapp.com",
            projectId: "cac-goodworks",
            storageBucket: "cac-goodworks.appspot.com",
            messagingSenderId: "1234567890",
            appId: "1:1234567890:web:abc123def456",
            measurementId: "G-EXAMPLE123"
        };

        // Initialize Firebase (commented out for demo - uncomment when you have Firebase project)
        // firebase.initializeApp(firebaseConfig);
        // const auth = firebase.auth();
        // const db = firebase.firestore();
        // const functions = firebase.functions();

        // ============================================
        // APPLICATION STATE
        // ============================================
        const appState = {
            currentUser: null,
            userRole: null,
            currentPage: 'dashboard',
            theme: localStorage.getItem('evangelismTheme') || 'light',
            sidebarCollapsed: localStorage.getItem('sidebarCollapsed') === 'true',
            offlineData: JSON.parse(localStorage.getItem('offlineEvangelismData') || '[]'),
            isOnline: navigator.onLine,
            isAuthenticated: false,
            currentTeam: null,
            lastSync: null,
            scriptureIndex: 0
        };

        // DEFAULT LOGIN CREDENTIALS
        const DEFAULT_USERS = [
            {
                id: 1,
                name: "Administrator",
                email: "admin@cacgoodworks.org",
                password: "Admin@2023",
                role: "admin",
                avatar: "AD",
                team: "Leadership",
                permissions: ["all"]
            },
            {
                id: 2,
                name: "Brother Moses",
                email: "moses@cacgoodworks.org",
                password: "moses@2026",
                role: "evangelist",
                avatar: "BM",
                team: "Alpha Team",
                permissions: ["report", "converts", "followups", "analytics"],
                isTeamLeader: true
            },
            {
                id: 3,
                name: "Brother Tolu",
                email: "tolu@cacgoodworks.org",
                password: "tolu@2026",
                role: "evangelist",
                avatar: "BT",
                team: "Beta Team",
                permissions: ["report", "converts", "followups"]
            },
            {
                id: 4,
                name: "Brother David Okoro",
                email: "david@cacgoodworks.org",
                password: "David@2023",
                role: "evangelist",
                avatar: "DO",
                team: "Gamma Team",
                permissions: ["report", "converts"]
            },
            {
                id: 5,
                name: "Sister Grace Adeyemi",
                email: "grace@cacgoodworks.org",
                password: "Grace@2023",
                role: "evangelist",
                avatar: "GA",
                team: "Delta Team",
                permissions: ["report"]
            }
        ];

        // Scripture verses for banner rotation
        const scriptures = [
            "Therefore go and make disciples of all nations, baptizing them in the name of the Father and of the Son and of the Holy Spirit. - Matthew 28:19",
            "The fruit of the righteous is a tree of life, and he who wins souls is wise. - Proverbs 11:30",
            "How beautiful on the mountains are the feet of those who bring good news, who proclaim peace, who bring good tidings, who proclaim salvation. - Isaiah 52:7",
            "The harvest is plentiful but the workers are few. Ask the Lord of the harvest, therefore, to send out workers into his harvest field. - Matthew 9:37-38",
            "I have become all things to all people so that by all possible means I might save some. - 1 Corinthians 9:22",
            "Let your light shine before others, that they may see your good deeds and glorify your Father in heaven. - Matthew 5:16",
            "For the Son of Man came to seek and to save the lost. - Luke 19:10",
            "But you will receive power when the Holy Spirit comes on you; and you will be my witnesses... to the ends of the earth. - Acts 1:8"
        ];

        // Mock data for demonstration (replace with Firebase data in production)
        const mockData = {
            users: DEFAULT_USERS,
            
            reports: [
                { id: 1, date: '2023-10-15', evangelist: 'Pastor James Williams', team: 'Alpha Team', location: 'Central Market', type: 'Street Evangelism', souls: 25, decisions: 8, status: 'Follow-up scheduled', notes: 'Great response from market traders. Several asked for prayer for their businesses.' },
                { id: 2, date: '2023-10-12', evangelist: 'Evangelist Sarah Johnson', team: 'Beta Team', location: 'University Campus', type: 'School Outreach', souls: 42, decisions: 15, status: 'Completed', notes: 'Student fellowship organized follow-up meetings. 5 students committed to discipleship program.' },
                { id: 3, date: '2023-10-10', evangelist: 'Brother David Okoro', team: 'Gamma Team', location: 'Liberty Estate', type: 'House-to-House', souls: 18, decisions: 6, status: 'Follow-up in progress', notes: 'Family of 4 made decisions together. Needs family counseling.' },
                { id: 4, date: '2023-10-08', evangelist: 'Administrator', team: 'Leadership', location: 'City Crusade', type: 'Crusade/Revival', souls: 120, decisions: 45, status: 'Completed', notes: 'Night of power event. Many healings reported. 12 filled with Holy Spirit.' },
                { id: 5, date: '2023-10-05', evangelist: 'Sister Grace Adeyemi', team: 'Delta Team', location: 'Online Campaign', type: 'Online Evangelism', souls: 85, decisions: 23, status: 'Follow-up scheduled', notes: 'Facebook live event reached 2.5k people. 23 decisions via chat.' },
                { id: 6, date: '2023-10-03', evangelist: 'Pastor James Williams', team: 'Alpha Team', location: 'General Hospital', type: 'Hospital Ministry', souls: 32, decisions: 11, status: 'Needs counseling', notes: 'Prayed with patients. 3 healings reported. Need counseling for terminal patients.' }
            ],
            
            converts: [
                { id: 1, name: 'Michael Brown', phone: '+2348012345678', whatsapp: true, date: '2023-10-15', age: 'Young Adult', gender: 'Male', address: 'Central Market, Lagos', status: 'Needs follow-up', followUpWorker: 'Pastor James Williams', prayerNeeds: 'Business success, family salvation', counseling: false, lifecycle: 1 },
                { id: 2, name: 'Grace Johnson', phone: '+2348023456789', whatsapp: true, date: '2023-10-12', age: 'Teen', gender: 'Female', address: 'University Hostel', status: 'Contacted', followUpWorker: 'Evangelist Sarah Johnson', prayerNeeds: 'Exams, future career', counseling: false, lifecycle: 2 },
                { id: 3, name: 'Peter Okonkwo', phone: '+2348034567890', whatsapp: false, date: '2023-10-10', age: 'Adult', gender: 'Male', address: 'Liberty Estate, Block 5', status: 'Attending church', followUpWorker: 'Brother David Okoro', prayerNeeds: 'Family unity, job stability', counseling: true, lifecycle: 3 },
                { id: 4, name: 'Blessing Adeyemi', phone: '+2348045678901', whatsapp: true, date: '2023-10-08', age: 'Young Adult', gender: 'Female', address: 'Ikeja, Lagos', status: 'Needs counseling', followUpWorker: 'Administrator', prayerNeeds: 'Anxiety, direction in life', counseling: true, lifecycle: 2 },
                { id: 5, name: 'Samuel Chukwu', phone: '+2348056789012', whatsapp: true, date: '2023-10-05', age: 'Adult', gender: 'Male', address: 'Surulere, Lagos', status: 'Integrated', followUpWorker: 'Sister Grace Adeyemi', prayerNeeds: 'Spiritual growth, leadership', counseling: false, lifecycle: 5 },
                { id: 6, name: 'Ruth Okoro', phone: '+2348067890123', whatsapp: true, date: '2023-10-03', age: 'Senior', gender: 'Female', address: 'General Hospital, Ward 4', status: 'Not reached', followUpWorker: 'Pastor James Williams', prayerNeeds: 'Healing from cancer', counseling: true, lifecycle: 1 }
            ],
            
            followUps: [
                { id: 1, convertId: 1, convertName: 'Michael Brown', phone: '+2348012345678', date: '2023-10-16', method: 'WhatsApp', status: 'Due today', assignedTo: 'Pastor James Williams', notes: 'Initial follow-up scheduled' },
                { id: 2, convertId: 2, convertName: 'Grace Johnson', phone: '+2348023456789', date: '2023-10-18', method: 'SMS', status: 'Upcoming', assignedTo: 'Evangelist Sarah Johnson', notes: 'Check on exam preparation' },
                { id: 3, convertId: 3, convertName: 'Peter Okonkwo', phone: '+2348034567890', date: '2023-10-20', method: 'Phone Call', status: 'Upcoming', assignedTo: 'Brother David Okoro', notes: 'Family counseling session' },
                { id: 4, convertId: 4, convertName: 'Blessing Adeyemi', phone: '+2348045678901', date: '2023-10-15', method: 'WhatsApp', status: 'Completed', assignedTo: 'Administrator', notes: 'Prayed together, encouraged to attend church' },
                { id: 5, convertId: 6, convertName: 'Ruth Okoro', phone: '+2348067890123', date: '2023-10-10', method: 'Visit', status: 'Overdue', assignedTo: 'Pastor James Williams', notes: 'Hospital visit - needs healing prayer' }
            ],
            
            auditLogs: [
                { id: 1, timestamp: '2023-10-15 14:30:22', user: 'Administrator', action: 'CREATE', entity: 'Evangelism Report', details: 'Created report #45 for City Crusade', ip: '192.168.1.101' },
                { id: 2, timestamp: '2023-10-15 11:15:45', user: 'Pastor James Williams', action: 'UPDATE', entity: 'Convert', details: 'Updated follow-up status for Michael Brown', ip: '192.168.1.102' },
                { id: 3, timestamp: '2023-10-14 16:20:33', user: 'Evangelist Sarah Johnson', action: 'CREATE', entity: 'Evangelism Report', details: 'Created report #46 for University Outreach', ip: '192.168.1.103' },
                { id: 4, timestamp: '2023-10-14 09:45:12', user: 'Administrator', action: 'LOGIN', entity: 'System', details: 'User logged in from new device', ip: '192.168.1.101' },
                { id: 5, timestamp: '2023-10-13 13:10:28', user: 'Brother David Okoro', action: 'CREATE', entity: 'Follow-up', details: 'Scheduled follow-up for Peter Okonkwo', ip: '192.168.1.104' }
            ]
        };

        // ============================================
        // DOM ELEMENTS
        // ============================================
        // Login Page
        const loginPage = document.getElementById('loginPage');
        const appContainer = document.getElementById('appContainer');
        const loginForm = document.getElementById('loginForm');
        const loginAlert = document.getElementById('loginAlert');
        const forgotPasswordLink = document.getElementById('forgotPasswordLink');
        
        // Main App
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const collapseToggle = document.getElementById('collapseToggle');
        const themeToggle = document.getElementById('themeToggle');
        const logoutBtn = document.getElementById('logoutBtn');
        const pageTitle = document.getElementById('pageTitle');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userRole = document.getElementById('userRole');
        const scriptureBanner = document.getElementById('scriptureBanner');
        const offlineIndicator = document.getElementById('offlineIndicator');
        const syncStatus = document.getElementById('syncStatus');
        
        // Navigation
        const navLinks = document.querySelectorAll('.nav-link');
        const pageContents = document.querySelectorAll('.page-content');
        
        // Dashboard Elements
        const totalSouls = document.getElementById('totalSouls');
        const totalOutreaches = document.getElementById('totalOutreaches');
        const totalConverts = document.getElementById('totalConverts');
        const activeFollowups = document.getElementById('activeFollowups');
        const recentReportsTable = document.getElementById('recentReportsTable');
        
        // Report Page
        const evangelismForm = document.getElementById('evangelismForm');
        const clearFormBtn = document.getElementById('clearFormBtn');
        const saveDraftBtn = document.getElementById('saveDraftBtn');
        const addAnotherConvertBtn = document.getElementById('addAnotherConvertBtn');
        const getLocationBtn = document.getElementById('getLocationBtn');
        const formAlert = document.getElementById('formAlert');
        
        // Converts Page
        const convertsTable = document.getElementById('convertsTable');
        const followupTable = document.getElementById('followupTable');
        const addConvertBtn = document.getElementById('addConvertBtn');
        const importConvertsBtn = document.getElementById('importConvertsBtn');
        const exportConvertsBtn = document.getElementById('exportConvertsBtn');
        const testimonyUpload = document.getElementById('testimonyUpload');
        const uploadedTestimonies = document.getElementById('uploadedTestimonies');
        
        // Follow-ups Page
        const dueFollowups = document.getElementById('dueFollowups');
        const upcomingFollowups = document.getElementById('upcomingFollowups');
        const completedFollowups = document.getElementById('completedFollowups');
        const pendingMessages = document.getElementById('pendingMessages');
        const followupScheduleTable = document.getElementById('followupScheduleTable');
        const autoScheduleBtn = document.getElementById('autoScheduleBtn');
        const sendBulkBtn = document.getElementById('sendBulkBtn');
        const sendFollowupBtn = document.getElementById('sendFollowupBtn');
        const scheduleFollowupBtn = document.getElementById('scheduleFollowupBtn');
        const testFollowupBtn = document.getElementById('testFollowupBtn');
        
        // Reports Page
        const generateReportBtn = document.getElementById('generateReportBtn');
        const previewReportBtn = document.getElementById('previewReportBtn');
        const saveTemplateBtn = document.getElementById('saveTemplateBtn');
        const scheduleReportBtn = document.getElementById('scheduleReportBtn');
        const printPreviewBtn = document.getElementById('printPreviewBtn');
        const reportPreview = document.getElementById('reportPreview');
        const previewContent = document.getElementById('previewContent');
        const reportAlert = document.getElementById('reportAlert');
        const customDateRange = document.getElementById('customDateRange');
        const dateRangeSelect = document.getElementById('dateRange');
        
        // Settings Page
        const reminderCustom = document.getElementById('reminderCustom');
        const customDays = document.getElementById('customDays');
        
        // Audit Page
        const exportLogsBtn = document.getElementById('exportLogsBtn');
        const clearOldLogsBtn = document.getElementById('clearOldLogsBtn');
        const auditLogsTable = document.getElementById('auditLogsTable');
        
        // Tabs
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // ============================================
        // INITIALIZATION
        // ============================================
        function initApp() {
            // Set initial theme
            if (appState.theme === 'dark') {
                document.body.classList.add('dark-mode');
            }
            
            // Set sidebar state
            if (appState.sidebarCollapsed) {
                sidebar.classList.add('collapsed');
                const icon = collapseToggle.querySelector('i');
                icon.classList.remove('fa-chevron-left');
                icon.classList.add('fa-chevron-right');
            }
            
            // Set initial scripture
            updateScriptureBanner();
            
            // Check if user is already logged in (from localStorage)
            const savedUser = localStorage.getItem('evangelismUser');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                loginUser(user);
            }
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize charts
            initCharts();
            
            // Initialize heat map
            initHeatMap();
            
            // Load mock data
            loadMockData();
            
            // Check online status
            updateOnlineStatus();
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            
            // Start scripture rotation
            setInterval(rotateScripture, 15000);
            
            // Auto-save form data
            setupAutoSave();
            
            console.log('CAC Good Works Assembly Evangelism Tracking System initialized');
        }

        // ============================================
        // EVENT LISTENERS SETUP
        // ============================================
        function setupEventListeners() {
            // Login form
            loginForm.addEventListener('submit', handleLogin);
            forgotPasswordLink.addEventListener('click', handleForgotPassword);
            
            // Quick login buttons
            document.querySelectorAll('.quick-fill-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const email = btn.getAttribute('data-email');
                    const password = btn.getAttribute('data-password');
                    const role = btn.getAttribute('data-role');
                    
                    document.getElementById('loginEmail').value = email;
                    document.getElementById('loginPassword').value = password;
                    document.getElementById('loginRole').value = role;
                    
                    showAlert(`Credentials for ${email} loaded. Click "Login to System" to continue.`, 'success', loginAlert);
                });
            });
            
            // Logout
            logoutBtn.addEventListener('click', handleLogout);
            
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // Sidebar
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
            
            collapseToggle.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
                appState.sidebarCollapsed = sidebar.classList.contains('collapsed');
                localStorage.setItem('sidebarCollapsed', appState.sidebarCollapsed);
                
                const icon = collapseToggle.querySelector('i');
                if (appState.sidebarCollapsed) {
                    icon.classList.remove('fa-chevron-left');
                    icon.classList.add('fa-chevron-right');
                } else {
                    icon.classList.remove('fa-chevron-right');
                    icon.classList.add('fa-chevron-left');
                }
            });
            
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    navigateToPage(page);
                });
            });
            
            // Tabs
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // Report form
            evangelismForm.addEventListener('submit', handleReportSubmit);
            clearFormBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear the form? All unsaved data will be lost.')) {
                    evangelismForm.reset();
                    showAlert('Form cleared successfully.', 'success', formAlert);
                }
            });
            
            saveDraftBtn.addEventListener('click', () => {
                saveFormDraft();
            });
            
            addAnotherConvertBtn.addEventListener('click', () => {
                showAlert('Feature: Add multiple converts in one report (coming soon)', 'info', formAlert);
            });
            
            getLocationBtn.addEventListener('click', () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            // Reverse geocoding would be implemented here
                            document.getElementById('location').value = `Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}`;
                            showAlert('Location captured successfully.', 'success', formAlert);
                        },
                        () => {
                            showAlert('Unable to get your location. Please enter manually.', 'error', formAlert);
                        }
                    );
                } else {
                    showAlert('Geolocation is not supported by your browser.', 'error', formAlert);
                }
            });
            
            // Converts page
            addConvertBtn.addEventListener('click', () => {
                navigateToPage('report');
            });
            
            importConvertsBtn.addEventListener('click', () => {
                showAlert('Import feature will be available in the next update.', 'info', formAlert);
            });
            
            exportConvertsBtn.addEventListener('click', () => {
                exportConvertsToExcel();
            });
            
            testimonyUpload.addEventListener('click', () => {
                // Create file input
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.txt,.mp3,.wav,.m4a';
                fileInput.style.display = 'none';
                fileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        uploadTestimony(file);
                    }
                });
                document.body.appendChild(fileInput);
                fileInput.click();
                document.body.removeChild(fileInput);
            });
            
            // Follow-ups page
            autoScheduleBtn.addEventListener('click', () => {
                autoScheduleFollowUps();
            });
            
            sendBulkBtn.addEventListener('click', () => {
                showAlert('Bulk messaging feature will be available with SMS/WhatsApp integration.', 'info', formAlert);
            });
            
            sendFollowupBtn.addEventListener('click', () => {
                sendFollowup();
            });
            
            scheduleFollowupBtn.addEventListener('click', () => {
                scheduleFollowup();
            });
            
            testFollowupBtn.addEventListener('click', () => {
                testFollowup();
            });
            
            // Reports page
            generateReportBtn.addEventListener('click', generateReport);
            previewReportBtn.addEventListener('click', previewReport);
            saveTemplateBtn.addEventListener('click', () => {
                showAlert('Report template saved successfully.', 'success', reportAlert);
            });
            
            scheduleReportBtn.addEventListener('click', () => {
                showAlert('Auto-report scheduling configured.', 'success', reportAlert);
            });
            
            printPreviewBtn.addEventListener('click', () => {
                window.print();
            });
            
            dateRangeSelect.addEventListener('change', () => {
                if (dateRangeSelect.value === 'custom') {
                    customDateRange.style.display = 'grid';
                } else {
                    customDateRange.style.display = 'none';
                }
            });
            
            // Settings page
            reminderCustom.addEventListener('change', () => {
                customDays.disabled = !reminderCustom.checked;
                if (!reminderCustom.checked) {
                    customDays.value = '';
                }
            });
            
            // Audit page
            exportLogsBtn.addEventListener('click', () => {
                exportAuditLogs();
            });
            
            clearOldLogsBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear audit logs older than 90 days?')) {
                    showAlert('Old logs cleared (demo only). In production, this would delete old records.', 'success', reportAlert);
                }
            });
        }

        // ============================================
        // AUTHENTICATION FUNCTIONS
        // ============================================
        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const role = document.getElementById('loginRole').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            const twoFactor = document.getElementById('twoFactor').checked;
            
            // Validation
            if (!email || !password || !role) {
                showAlert('Please fill in all required fields.', 'error', loginAlert);
                return;
            }
            
            // Check against default users
            const user = DEFAULT_USERS.find(u => 
                u.email === email && 
                u.password === password && 
                u.role === role
            );
            
            if (user) {
                // Simulate 2FA if enabled
                if (twoFactor) {
                    showAlert('Two-factor authentication code sent to your email. (Demo: 123456)', 'info', loginAlert);
                    setTimeout(() => {
                        completeLogin(user, rememberMe);
                    }, 1500);
                } else {
                    completeLogin(user, rememberMe);
                }
            } else {
                // Check if it's a demo user with wrong password
                const userExists = DEFAULT_USERS.find(u => u.email === email && u.role === role);
                if (userExists) {
                    showAlert('Invalid password. Try: ' + userExists.password, 'error', loginAlert);
                } else {
                    showAlert('Invalid credentials. Use the demo accounts provided.', 'error', loginAlert);
                }
            }
        }

        function completeLogin(user, rememberMe) {
            // Log audit
            logAudit('LOGIN', 'System', `User logged in${rememberMe ? ' with remember me' : ''}`);
            
            // Set user in app state
            appState.currentUser = user;
            appState.userRole = user.role;
            appState.isAuthenticated = true;
            
            // Save to localStorage if remember me is checked
            if (rememberMe) {
                localStorage.setItem('evangelismUser', JSON.stringify(user));
            }
            
            // Update UI
            userName.textContent = user.name;
            userRole.textContent = user.role === 'admin' ? 'Administrator' : 'Evangelist';
            userAvatar.textContent = user.avatar;
            
            // Switch to app view
            loginPage.style.display = 'none';
            appContainer.style.display = 'block';
            
            // Load user-specific data
            loadUserData();
            
            // Show welcome message
            showAlert(`Welcome, ${user.name}! You are logged in as ${user.role}.`, 'success', formAlert);
            
            // Navigate to dashboard
            navigateToPage('dashboard');
            
            // Update sync status
            updateSyncStatus();
        }

        function handleForgotPassword(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value || 'your email';
            showAlert(`Password reset link sent to ${email}. Check your inbox.`, 'success', loginAlert);
        }

        function handleLogout() {
            // Log audit
            logAudit('LOGOUT', 'System', 'User logged out');
            
            // Clear user data
            appState.currentUser = null;
            appState.userRole = null;
            appState.isAuthenticated = false;
            
            // Clear localStorage (except theme and sidebar preference)
            localStorage.removeItem('evangelismUser');
            
            // Show login page
            appContainer.style.display = 'none';
            loginPage.style.display = 'flex';
            
            // Reset login form
            loginForm.reset();
            
            showAlert('You have been logged out successfully.', 'success', loginAlert);
        }

        // ============================================
        // UI FUNCTIONS
        // ============================================
        function toggleTheme() {
            if (appState.theme === 'light') {
                document.body.classList.add('dark-mode');
                appState.theme = 'dark';
            } else {
                document.body.classList.remove('dark-mode');
                appState.theme = 'light';
            }
            
            localStorage.setItem('evangelismTheme', appState.theme);
            
            // Update charts for new theme
            updateChartsTheme();
        }

        function navigateToPage(page) {
            // Update active nav link
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('active');
                }
            });
            
            // Update active page content
            pageContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${page}Page`) {
                    content.classList.add('active');
                }
            });
            
            // Update page title
            const pageTitles = {
                dashboard: 'Evangelism Dashboard',
                report: 'New Evangelism Report',
                converts: 'Convert Management',
                followups: 'Follow-up System',
                analytics: 'Analytics & Insights',
                heatmap: 'Evangelism Heat Map',
                reports: 'Report Generator',
                settings: 'System Settings',
                audit: 'Audit Logs'
            };
            
            pageTitle.textContent = pageTitles[page];
            appState.currentPage = page;
            
            // Update scripture based on page
            updateScriptureBanner();
            
            // Close sidebar on mobile after navigation
            if (window.innerWidth <= 992) {
                sidebar.classList.remove('active');
            }
            
            // Load page-specific data
            switch(page) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'converts':
                    loadConvertsData();
                    break;
                case 'followups':
                    loadFollowupsData();
                    break;
                case 'analytics':
                    updateAnalytics();
                    break;
                case 'heatmap':
                    updateHeatMap();
                    break;
                case 'audit':
                    loadAuditLogs();
                    break;
            }
        }

        function switchTab(tabId) {
            // Update active tab button
            tabBtns.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === tabId) {
                    btn.classList.add('active');
                }
            });
            
            // Update active tab content
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === tabId) {
                    content.classList.add('active');
                }
            });
        }

        function updateScriptureBanner() {
            // Rotate through scriptures
            scriptureBanner.textContent = scriptures[appState.scriptureIndex];
            appState.scriptureIndex = (appState.scriptureIndex + 1) % scriptures.length;
        }

        function rotateScripture() {
            if (appState.currentPage === 'dashboard' || Math.random() > 0.7) {
                updateScriptureBanner();
            }
        }

        function showAlert(message, type, container) {
            container.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                   type === 'error' ? 'exclamation-circle' : 
                                   type === 'warning' ? 'exclamation-triangle' : 
                                   'info-circle'}"></i>
                <span>${message}</span>
            `;
            container.className = `alert alert-${type}`;
            container.style.display = 'flex';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                container.style.display = 'none';
            }, 5000);
        }

        // ============================================
        // DATA MANAGEMENT FUNCTIONS
        // ============================================
        function loadMockData() {
            updateDashboard();
            loadConvertsData();
            loadFollowupsData();
            loadAuditLogs();
        }

        function updateDashboard() {
            // Calculate totals from mock data
            const totalSoulsValue = mockData.reports.reduce((sum, report) => sum + report.souls, 0);
            const totalOutreachesValue = mockData.reports.length;
            const totalConvertsValue = mockData.reports.reduce((sum, report) => sum + report.decisions, 0);
            const activeFollowupsValue = mockData.followUps.filter(f => 
                f.status === 'Due today' || f.status === 'Upcoming' || f.status === 'Overdue'
            ).length;
            
            // Update cards
            totalSouls.textContent = totalSoulsValue.toLocaleString();
            totalOutreaches.textContent = totalOutreachesValue;
            totalConverts.textContent = totalConvertsValue;
            activeFollowups.textContent = activeFollowupsValue;
            
            // Update recent reports table
            recentReportsTable.innerHTML = '';
            mockData.reports.slice(0, 6).forEach(report => {
                const row = document.createElement('tr');
                
                let statusClass = 'status-pending';
                if (report.status === 'Completed') statusClass = 'status-integrated';
                if (report.status.includes('Follow-up')) statusClass = 'status-attending';
                
                row.innerHTML = `
                    <td>${formatDate(report.date)}</td>
                    <td>${report.evangelist}</td>
                    <td>${report.location}</td>
                    <td>${report.type}</td>
                    <td>${report.souls}</td>
                    <td>${report.decisions}</td>
                    <td><span class="status-badge ${statusClass}">${report.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="viewReport(${report.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                recentReportsTable.appendChild(row);
            });
        }

        function loadConvertsData() {
            // Update all converts table
            convertsTable.innerHTML = '';
            mockData.converts.forEach(convert => {
                const row = document.createElement('tr');
                
                let statusClass = 'status-pending';
                if (convert.status === 'Contacted') statusClass = 'status-contacted';
                if (convert.status === 'Not reached') statusClass = 'status-not-reached';
                if (convert.status === 'Attending church') statusClass = 'status-attending';
                if (convert.status === 'Needs counseling') statusClass = 'status-counseling';
                if (convert.status === 'Integrated') statusClass = 'status-integrated';
                
                row.innerHTML = `
                    <td>${convert.name}</td>
                    <td>${convert.phone} ${convert.whatsapp ? '<i class="fas fa-comment" style="color: #25D366;"></i>' : ''}</td>
                    <td>${formatDate(convert.date)}</td>
                    <td>${convert.age}/${convert.gender}</td>
                    <td><span class="status-badge ${statusClass}">${convert.status}</span></td>
                    <td>${convert.followUpWorker}</td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="viewConvert(${convert.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-primary" onclick="scheduleFollowupForConvert(${convert.id})">
                            <i class="fas fa-bell"></i>
                        </button>
                    </td>
                `;
                convertsTable.appendChild(row);
            });
            
            // Update needs follow-up table
            followupTable.innerHTML = '';
            const needsFollowup = mockData.converts.filter(c => 
                c.status === 'Needs follow-up' || c.status === 'Not reached'
            );
            
            needsFollowup.forEach(convert => {
                const daysSince = Math.floor((new Date() - new Date(convert.date)) / (1000 * 60 * 60 * 24));
                const followUp = mockData.followUps.find(f => f.convertId === convert.id);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${convert.name}</td>
                    <td>${convert.phone}</td>
                    <td>${formatDate(convert.date)}</td>
                    <td>${daysSince} days</td>
                    <td>${convert.followUpWorker}</td>
                    <td>${followUp ? formatDate(followUp.date) : 'Not scheduled'}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="contactConvert(${convert.id})">
                            <i class="fas fa-phone"></i>
                        </button>
                    </td>
                `;
                followupTable.appendChild(row);
            });
        }

        function loadFollowupsData() {
            // Update follow-up cards
            const dueToday = mockData.followUps.filter(f => f.status === 'Due today').length;
            const upcoming = mockData.followUps.filter(f => f.status === 'Upcoming').length;
            const completed = mockData.followUps.filter(f => f.status === 'Completed').length;
            const overdue = mockData.followUps.filter(f => f.status === 'Overdue').length;
            
            dueFollowups.textContent = dueToday + overdue;
            upcomingFollowups.textContent = upcoming;
            completedFollowups.textContent = completed;
            pendingMessages.textContent = dueToday + upcoming + overdue;
            
            // Update follow-up badge in sidebar
            document.getElementById('followupBadge').textContent = dueToday + overdue;
            
            // Update follow-up schedule table
            followupScheduleTable.innerHTML = '';
            mockData.followUps.forEach(followUp => {
                const row = document.createElement('tr');
                
                let statusClass = 'status-pending';
                if (followUp.status === 'Due today') statusClass = 'status-counseling';
                if (followUp.status === 'Overdue') statusClass = 'status-not-reached';
                if (followUp.status === 'Completed') statusClass = 'status-integrated';
                if (followUp.status === 'Upcoming') statusClass = 'status-attending';
                
                row.innerHTML = `
                    <td>${followUp.convertName}</td>
                    <td>${followUp.phone}</td>
                    <td>${formatDate(followUp.date)}</td>
                    <td>${followUp.method}</td>
                    <td><span class="status-badge ${statusClass}">${followUp.status}</span></td>
                    <td>${followUp.assignedTo}</td>
                    <td>
                        <button class="btn btn-sm btn-success" onclick="completeFollowup(${followUp.id})">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="rescheduleFollowup(${followUp.id})">
                            <i class="fas fa-calendar-alt"></i>
                        </button>
                    </td>
                `;
                followupScheduleTable.appendChild(row);
            });
        }

        function loadAuditLogs() {
            auditLogsTable.innerHTML = '';
            mockData.auditLogs.forEach(log => {
                const row = document.createElement('tr');
                
                let actionColor = 'var(--text-secondary)';
                if (log.action === 'CREATE') actionColor = 'var(--success)';
                if (log.action === 'UPDATE') actionColor = 'var(--warning)';
                if (log.action === 'DELETE') actionColor = 'var(--danger)';
                if (log.action === 'LOGIN') actionColor = 'var(--info)';
                
                row.innerHTML = `
                    <td>${log.timestamp}</td>
                    <td>${log.user}</td>
                    <td><span style="color: ${actionColor}; font-weight: 600;">${log.action}</span></td>
                    <td>${log.entity}</td>
                    <td>${log.details}</td>
                    <td><code>${log.ip}</code></td>
                `;
                auditLogsTable.appendChild(row);
            });
        }

        function loadUserData() {
            // Filter data based on user role and permissions
            if (appState.userRole === 'evangelist') {
                // For evangelists, only show their data
                const userReports = mockData.reports.filter(r => r.evangelist === appState.currentUser.name);
                const userConverts = mockData.converts.filter(c => c.followUpWorker === appState.currentUser.name);
                
                // Update dashboard for evangelist view
                if (appState.currentPage === 'dashboard') {
                    const totalSoulsValue = userReports.reduce((sum, report) => sum + report.souls, 0);
                    const totalOutreachesValue = userReports.length;
                    const totalConvertsValue = userReports.reduce((sum, report) => sum + report.decisions, 0);
                    const activeFollowupsValue = userConverts.filter(c => 
                        c.status === 'Needs follow-up' || c.status === 'Not reached'
                    ).length;
                    
                    totalSouls.textContent = totalSoulsValue.toLocaleString();
                    totalOutreaches.textContent = totalOutreachesValue;
                    totalConverts.textContent = totalConvertsValue;
                    activeFollowups.textContent = activeFollowupsValue;
                }
            }
        }

        // ============================================
        // FORM HANDLING FUNCTIONS
        // ============================================
        function handleReportSubmit(e) {
            e.preventDefault();
            
            // Get form values
            const formData = {
                evangelistName: document.getElementById('evangelistName').value || appState.currentUser.name,
                team: document.getElementById('team').value || appState.currentUser.team,
                outreachDate: document.getElementById('outreachDate').value,
                location: document.getElementById('location').value,
                outreachType: document.getElementById('outreachType').value,
                soulsReached: parseInt(document.getElementById('soulsReached').value) || 0,
                decisions: parseInt(document.getElementById('decisions').value) || 0,
                notes: document.getElementById('notes').value,
                convertName: document.getElementById('convertName').value,
                convertPhone: document.getElementById('convertPhone').value,
                convertGender: document.getElementById('convertGender').value,
                convertAge: document.getElementById('convertAge').value,
                convertAddress: document.getElementById('convertAddress').value,
                followupWorker: document.getElementById('followupWorker').value || appState.currentUser.name,
                prayerNeeds: document.getElementById('prayerNeeds').value,
                whatsappAvailable: document.getElementById('whatsappAvailable').checked,
                needsCounseling: document.getElementById('needsCounseling').checked,
                timestamp: new Date().toISOString()
            };
            
            // Validate required fields
            if (!formData.evangelistName || !formData.outreachDate || !formData.location || 
                !formData.outreachType || isNaN(formData.soulsReached) || isNaN(formData.decisions)) {
                showAlert('Please fill in all required fields.', 'error', formAlert);
                return;
            }
            
            // Create report object
            const report = {
                id: mockData.reports.length + 1,
                ...formData,
                status: 'Submitted',
                submittedBy: appState.currentUser.name,
                submittedAt: new Date().toISOString()
            };
            
            // Add to reports
            mockData.reports.unshift(report);
            
            // Log audit
            logAudit('CREATE', 'Evangelism Report', `Created report #${report.id} for ${report.location}`);
            
            // Add convert if information provided
            if (formData.convertName) {
                const convert = {
                    id: mockData.converts.length + 1,
                    name: formData.convertName,
                    phone: formData.convertPhone,
                    whatsapp: formData.whatsappAvailable,
                    date: formData.outreachDate,
                    age: formData.convertAge,
                    gender: formData.convertGender,
                    address: formData.convertAddress,
                    status: 'Needs follow-up',
                    followUpWorker: formData.followupWorker,
                    prayerNeeds: formData.prayerNeeds,
                    counseling: formData.needsCounseling,
                    lifecycle: 1,
                    reportId: report.id
                };
                
                mockData.converts.push(convert);
                
                // Schedule automatic follow-ups
                scheduleAutomaticFollowUps(convert);
                
                // Log audit
                logAudit('CREATE', 'Convert', `Added convert: ${convert.name}`);
            }
            
            // Show success message
            showAlert(`Evangelism report saved successfully! ${formData.decisions} decision(s) recorded.`, 'success', formAlert);
            
            // Reset form
            evangelismForm.reset();
            
            // Pre-fill evangelist name for next report
            document.getElementById('evangelistName').value = appState.currentUser.name;
            document.getElementById('team').value = appState.currentUser.team;
            
            // Update dashboard if on dashboard page
            if (appState.currentPage === 'dashboard') {
                updateDashboard();
            }
            
            // If offline, store in offline storage
            if (!appState.isOnline) {
                storeOfflineData(report);
            }
            
            // Navigate to dashboard after successful submission
            setTimeout(() => {
                navigateToPage('dashboard');
            }, 2000);
        }

        function saveFormDraft() {
            // Get form values
            const formData = {
                evangelistName: document.getElementById('evangelistName').value,
                team: document.getElementById('team').value,
                outreachDate: document.getElementById('outreachDate').value,
                location: document.getElementById('location').value,
                outreachType: document.getElementById('outreachType').value,
                soulsReached: document.getElementById('soulsReached').value,
                decisions: document.getElementById('decisions').value,
                notes: document.getElementById('notes').value,
                timestamp: new Date().toISOString()
            };
            
            // Save to localStorage
            localStorage.setItem('evangelismDraft', JSON.stringify(formData));
            
            showAlert('Draft saved successfully. You can continue later.', 'success', formAlert);
        }

        function setupAutoSave() {
            // Auto-save form every 30 seconds
            setInterval(() => {
                if (appState.currentPage === 'report') {
                    const form = document.getElementById('evangelismForm');
                    const hasData = Array.from(form.elements).some(element => 
                        (element.type !== 'submit' && element.type !== 'button' && element.value)
                    );
                    
                    if (hasData) {
                        saveFormDraft();
                    }
                }
            }, 30000);
            
            // Load draft if exists
            const draft = localStorage.getItem('evangelismDraft');
            if (draft && appState.currentPage === 'report') {
                try {
                    const formData = JSON.parse(draft);
                    Object.keys(formData).forEach(key => {
                        const element = document.getElementById(key);
                        if (element && formData[key]) {
                            element.value = formData[key];
                        }
                    });
                    showAlert('Draft loaded. Continue where you left off.', 'info', formAlert);
                } catch (e) {
                    console.error('Error loading draft:', e);
                }
            }
        }

        // ============================================
        // FOLLOW-UP SYSTEM FUNCTIONS
        // ============================================
        function scheduleAutomaticFollowUps(convert) {
            const followUpDates = [
                { days: 1, method: 'WhatsApp', type: 'initial' },
                { days: 3, method: 'SMS', type: 'check-in' },
                { days: 7, method: 'Phone Call', type: 'follow-up' },
                { days: 14, method: 'WhatsApp', type: 'discipleship' },
                { days: 30, method: 'Email', type: 'integration' }
            ];
            
            followUpDates.forEach((followUp, index) => {
                const followUpDate = new Date(convert.date);
                followUpDate.setDate(followUpDate.getDate() + followUp.days);
                
                const status = index === 0 ? 'Due today' : 
                              followUp.days <= 7 ? 'Upcoming' : 'Scheduled';
                
                const followUpItem = {
                    id: mockData.followUps.length + 1,
                    convertId: convert.id,
                    convertName: convert.name,
                    phone: convert.phone,
                    date: followUpDate.toISOString().split('T')[0],
                    method: followUp.method,
                    type: followUp.type,
                    status: status,
                    assignedTo: convert.followUpWorker,
                    notes: `Automatic ${followUp.type} follow-up`,
                    autoScheduled: true
                };
                
                mockData.followUps.push(followUpItem);
            });
            
            showAlert(`5 automatic follow-ups scheduled for ${convert.name}.`, 'info', formAlert);
        }

        function autoScheduleFollowUps() {
            const unscheduledConverts = mockData.converts.filter(convert => 
                !mockData.followUps.some(f => f.convertId === convert.id) && 
                convert.status === 'Needs follow-up'
            );
            
            unscheduledConverts.forEach(convert => {
                scheduleAutomaticFollowUps(convert);
            });
            
            showAlert(`Scheduled follow-ups for ${unscheduledConverts.length} converts.`, 'success', formAlert);
            
            // Update UI
            loadFollowupsData();
        }

        function sendFollowup() {
            const recipient = document.getElementById('followupRecipient').value;
            const method = document.getElementById('followupMethod').value;
            const message = document.getElementById('followupMessage').value;
            const interval = document.getElementById('followupInterval').value;
            
            if (!recipient || !message) {
                showAlert('Please select a recipient and enter a message.', 'error', formAlert);
                return;
            }
            
            // Simulate sending
            showAlert(`Follow-up sent via ${method} successfully! ${interval !== 'custom' ? `Next follow-up in ${interval} hours.` : ''}`, 'success', formAlert);
            
            // Clear message
            document.getElementById('followupMessage').value = '';
            
            // Log audit
            logAudit('CREATE', 'Follow-up', `Sent ${method} follow-up to ${recipient}`);
        }

        function scheduleFollowup() {
            showAlert('Follow-up scheduled successfully. Reminders will be sent automatically.', 'success', formAlert);
        }

        function testFollowup() {
            showAlert('Test message sent to your account. Check your notifications.', 'success', formAlert);
        }

        // ============================================
        // REPORT GENERATION FUNCTIONS
        // ============================================
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('dateRange').value;
            const format = document.getElementById('reportFormat').value;
            const template = document.getElementById('reportTemplate').value;
            
            showAlert(`Generating ${reportType} report in ${format.toUpperCase()} format...`, 'info', reportAlert);
            
            // Simulate generation delay
            setTimeout(() => {
                if (format === 'pdf') {
                    generatePDFReport();
                } else if (format === 'excel') {
                    generateExcelReport();
                } else if (format === 'csv') {
                    generateCSVReport();
                }
                
                showAlert(`Report generated successfully! Download will start automatically.`, 'success', reportAlert);
                
                // Log audit
                logAudit('CREATE', 'Report', `Generated ${reportType} report in ${format} format`);
            }, 2000);
        }

        function previewReport() {
            const reportType = document.getElementById('reportType').value;
            
            // Create preview content
            let previewHTML = `
                <div style="padding: 20px; background: white; color: #333;">
                    <h2 style="text-align: center; color: var(--primary); margin-bottom: 10px;">
                        CAC Good Works Assembly - Evangelism Report
                    </h2>
                    <p style="text-align: center; color: #666; margin-bottom: 30px;">
                        ${reportType.charAt(0).toUpperCase() + reportType.slice(1)} Report | Generated on ${new Date().toLocaleDateString()}
                    </p>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--primary);">
                                ${mockData.reports.reduce((sum, report) => sum + report.souls, 0).toLocaleString()}
                            </div>
                            <div style="font-size: 14px; color: #666;">Souls Reached</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--primary);">
                                ${mockData.reports.length}
                            </div>
                            <div style="font-size: 14px; color: #666;">Outreaches</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--primary);">
                                ${mockData.reports.reduce((sum, report) => sum + report.decisions, 0)}
                            </div>
                            <div style="font-size: 14px; color: #666;">Decisions</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--primary);">
                                ${mockData.converts.filter(c => c.status === 'Integrated').length}
                            </div>
                            <div style="font-size: 14px; color: #666;">Integrated</div>
                        </div>
                    </div>
                    
                    <h3 style="color: var(--primary); margin-bottom: 15px;">Recent Evangelism Activities</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Date</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Location</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Type</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Souls</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Decisions</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            mockData.reports.slice(0, 5).forEach(report => {
                previewHTML += `
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${formatDate(report.date)}</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${report.location}</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${report.type}</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${report.souls}</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${report.decisions}</td>
                    </tr>
                `;
            });
            
            previewHTML += `
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;">
                        <p style="color: #666; font-size: 14px;">
                            <strong>Report Summary:</strong> The evangelism efforts have shown consistent growth with a ${Math.round(mockData.reports.reduce((sum, report) => sum + report.decisions, 0) / mockData.reports.reduce((sum, report) => sum + report.souls, 0) * 100)}% conversion rate overall.
                            Street evangelism remains the most effective method, while online outreach shows promising growth potential.
                        </p>
                        <p style="color: #666; font-size: 14px; margin-top: 10px;">
                            <strong>Recommendations:</strong> Increase focus on discipleship programs for new converts and expand online evangelism initiatives.
                        </p>
                    </div>
                    
                    <div style="margin-top: 40px; text-align: center; color: #999; font-size: 12px;">
                        <p>Generated by CAC Good Works Assembly Evangelism Tracking System v2.0</p>
                        <p>"Therefore go and make disciples of all nations..." - Matthew 28:19</p>
                    </div>
                </div>
            `;
            
            previewContent.innerHTML = previewHTML;
            reportPreview.style.display = 'block';
            
            // Scroll to preview
            reportPreview.scrollIntoView({ behavior: 'smooth' });
        }

        function generatePDFReport() {
            // In a real implementation, this would use jsPDF to generate PDF
            // For demo, we'll create a downloadable link
            const element = document.getElementById('previewContent');
            html2canvas(element).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save('evangelism-report.pdf');
            });
        }

        function generateExcelReport() {
            // Create workbook
            const wb = XLSX.utils.book_new();
            
            // Create reports sheet
            const reportsData = mockData.reports.map(report => ({
                Date: report.date,
                Evangelist: report.evangelist,
                Location: report.location,
                Type: report.type,
                'Souls Reached': report.souls,
                Decisions: report.decisions,
                Status: report.status,
                Team: report.team
            }));
            
            const reportsWs = XLSX.utils.json_to_sheet(reportsData);
            XLSX.utils.book_append_sheet(wb, reportsWs, 'Evangelism Reports');
            
            // Create converts sheet
            const convertsData = mockData.converts.map(convert => ({
                Name: convert.name,
                'Phone Number': convert.phone,
                'Date Saved': convert.date,
                'Age Range': convert.age,
                Gender: convert.gender,
                Status: convert.status,
                'Follow-up Worker': convert.followUpWorker,
                'Prayer Needs': convert.prayerNeeds
            }));
            
            const convertsWs = XLSX.utils.json_to_sheet(convertsData);
            XLSX.utils.book_append_sheet(wb, convertsWs, 'Converts');
            
            // Create summary sheet
            const summaryData = [{
                'Total Outreaches': mockData.reports.length,
                'Total Souls Reached': mockData.reports.reduce((sum, report) => sum + report.souls, 0),
                'Total Decisions': mockData.reports.reduce((sum, report) => sum + report.decisions, 0),
                'Active Follow-ups': mockData.followUps.filter(f => f.status === 'Due today' || f.status === 'Upcoming').length,
                'Conversion Rate': `${Math.round(mockData.reports.reduce((sum, report) => sum + report.decisions, 0) / mockData.reports.reduce((sum, report) => sum + report.souls, 0) * 100)}%`,
                'Report Generated': new Date().toLocaleDateString()
            }];
            
            const summaryWs = XLSX.utils.json_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, summaryWs, 'Summary');
            
            // Generate and download
            XLSX.writeFile(wb, 'evangelism-report.xlsx');
        }

        function generateCSVReport() {
            // Create CSV content
            let csv = 'Date,Evangelist,Location,Type,Souls Reached,Decisions,Status,Team\n';
            
            mockData.reports.forEach(report => {
                csv += `"${report.date}","${report.evangelist}","${report.location}","${report.type}",${report.souls},${report.decisions},"${report.status}","${report.team}"\n`;
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'evangelism-report.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // ============================================
        // ANALYTICS & CHARTS FUNCTIONS
        // ============================================
        let charts = {};

        function initCharts() {
            // Monthly trends chart
            const monthlyCtx = document.getElementById('monthlyTrendsChart').getContext('2d');
            charts.monthlyTrends = new Chart(monthlyCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [
                        {
                            label: 'Souls Reached',
                            data: [85, 120, 95, 150, 180, 210, 195, 230, 245, 260, 240, 280],
                            borderColor: '#4a148c',
                            backgroundColor: 'rgba(74, 20, 140, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3
                        },
                        {
                            label: 'Decisions for Christ',
                            data: [25, 35, 30, 45, 55, 65, 58, 70, 75, 80, 72, 85],
                            borderColor: '#ffd700',
                            backgroundColor: 'rgba(255, 215, 0, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--border')
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--border')
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'nearest'
                    }
                }
            });
            
            // Outreach types chart
            const outreachCtx = document.getElementById('outreachTypesChart').getContext('2d');
            charts.outreachTypes = new Chart(outreachCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Street Evangelism', 'Crusade/Revival', 'House-to-House', 'School Outreach', 'Online Evangelism', 'Hospital Ministry'],
                    datasets: [{
                        data: [35, 25, 15, 12, 8, 5],
                        backgroundColor: [
                            '#1a237e',
                            '#4a148c',
                            '#ffd700',
                            '#2196F3',
                            '#4CAF50',
                            '#FF9800'
                        ],
                        borderWidth: 2,
                        borderColor: getComputedStyle(document.body).getPropertyValue('--card-bg')
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary'),
                                padding: 20
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
            
            // Growth trends chart
            const growthCtx = document.getElementById('growthTrendsChart').getContext('2d');
            charts.growthTrends = new Chart(growthCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [
                        {
                            label: 'Souls Reached',
                            data: [85, 120, 95, 150, 180, 210, 195, 230, 245, 260, 240, 280],
                            backgroundColor: '#1a237e',
                            borderRadius: 6
                        },
                        {
                            label: 'Decisions',
                            data: [25, 35, 30, 45, 55, 65, 58, 70, 75, 80, 72, 85],
                            backgroundColor: '#ffd700',
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--border')
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--border')
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        }
                    }
                }
            });
            
            // Conversion rates chart
            const conversionCtx = document.getElementById('conversionRatesChart').getContext('2d');
            charts.conversionRates = new Chart(conversionCtx, {
                type: 'bar',
                data: {
                    labels: ['Street', 'Crusade', 'House-to-House', 'School', 'Online', 'Hospital'],
                    datasets: [{
                        label: 'Conversion Rate %',
                        data: [42, 38, 40, 36, 27, 34],
                        backgroundColor: [
                            '#1a237e',
                            '#4a148c',
                            '#ffd700',
                            '#2196F3',
                            '#4CAF50',
                            '#FF9800'
                        ],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--border')
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--border')
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary'),
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
            
            // Top evangelists chart
            const evangelistsCtx = document.getElementById('topEvangelistsChart').getContext('2d');
            charts.topEvangelists = new Chart(evangelistsCtx, {
                type: 'horizontalBar',
                data: {
                    labels: ['Pastor James Williams', 'Administrator', 'Evangelist Sarah Johnson', 'Brother David Okoro', 'Sister Grace Adeyemi'],
                    datasets: [
                        {
                            label: 'Souls Reached',
                            data: [352, 320, 295, 285, 245],
                            backgroundColor: '#1a237e',
                            borderRadius: 6
                        },
                        {
                            label: 'Decisions',
                            data: [146, 145, 130, 125, 111],
                            backgroundColor: '#ffd700',
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            beginAtZero: true,
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--border')
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        },
                        y: {
                            stacked: true,
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--border')
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        }
                    }
                }
            });
            
            // Locations chart
            const locationsCtx = document.getElementById('locationsChart').getContext('2d');
            charts.locations = new Chart(locationsCtx, {
                type: 'pie',
                data: {
                    labels: ['Central Market', 'University Campus', 'Liberty Estate', 'City Crusade', 'General Hospital', 'Online'],
                    datasets: [{
                        data: [25, 22, 18, 45, 11, 23],
                        backgroundColor: [
                            '#1a237e',
                            '#4a148c',
                            '#ffd700',
                            '#2196F3',
                            '#4CAF50',
                            '#FF9800'
                        ],
                        borderWidth: 2,
                        borderColor: getComputedStyle(document.body).getPropertyValue('--card-bg')
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary'),
                                padding: 15
                            }
                        }
                    }
                }
            });
            
            // Region effectiveness chart
            const regionCtx = document.getElementById('regionEffectivenessChart').getContext('2d');
            charts.regionEffectiveness = new Chart(regionCtx, {
                type: 'radar',
                data: {
                    labels: ['Central District', 'North District', 'South District', 'East District', 'West District', 'Online'],
                    datasets: [{
                        label: 'Conversion Rate',
                        data: [85, 70, 65, 75, 60, 45],
                        backgroundColor: 'rgba(26, 35, 126, 0.2)',
                        borderColor: '#1a237e',
                        borderWidth: 2,
                        pointBackgroundColor: '#1a237e',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            angleLines: {
                                color: getComputedStyle(document.body).getPropertyValue('--border')
                            },
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--border')
                            },
                            pointLabels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary'),
                                backdropColor: 'transparent'
                            },
                            min: 0,
                            max: 100
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            }
                        }
                    }
                }
            });
        }

        function updateChartsTheme() {
            // Update all charts with current theme colors
            Object.values(charts).forEach(chart => {
                if (chart.options && chart.options.scales) {
                    const textColor = getComputedStyle(document.body).getPropertyValue('--text-secondary');
                    const gridColor = getComputedStyle(document.body).getPropertyValue('--border');
                    
                    // Update scales
                    if (chart.options.scales.x) {
                        chart.options.scales.x.grid.color = gridColor;
                        chart.options.scales.x.ticks.color = textColor;
                    }
                    if (chart.options.scales.y) {
                        chart.options.scales.y.grid.color = gridColor;
                        chart.options.scales.y.ticks.color = textColor;
                    }
                    if (chart.options.scales.r) {
                        chart.options.scales.r.angleLines.color = gridColor;
                        chart.options.scales.r.grid.color = gridColor;
                        chart.options.scales.r.pointLabels.color = textColor;
                        chart.options.scales.r.ticks.color = textColor;
                    }
                    
                    // Update legend
                    if (chart.options.plugins.legend && chart.options.plugins.legend.labels) {
                        chart.options.plugins.legend.labels.color = getComputedStyle(document.body).getPropertyValue('--text-primary');
                    }
                }
                
                chart.update();
            });
        }

        function updateAnalytics() {
            // Refresh chart data
            // In a real app, this would fetch new data from Firebase
            // For demo, we'll just update the existing charts
            Object.values(charts).forEach(chart => {
                chart.update();
            });
        }

        // ============================================
        // HEAT MAP FUNCTIONS
        // ============================================
        let heatMap = null;

        function initHeatMap() {
            // Initialize Leaflet map
            heatMap = L.map('heatMap').setView([6.5244, 3.3792], 12); // Lagos coordinates
            
            // Add OpenStreetMap tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(heatMap);
            
            // Add some sample markers for evangelism locations
            const locations = [
                { lat: 6.5244, lng: 3.3792, title: 'Central Market', count: 25 },
                { lat: 6.4342, lng: 3.4258, title: 'University Campus', count: 42 },
                { lat: 6.4551, lng: 3.4481, title: 'Liberty Estate', count: 18 },
                { lat: 6.4970, lng: 3.3660, title: 'City Crusade Ground', count: 120 },
                { lat: 6.5025, lng: 3.3225, title: 'General Hospital', count: 32 },
                { lat: 6.4654, lng: 3.4065, title: 'Online Campaign', count: 85 }
            ];
            
            locations.forEach(location => {
                // Create circle marker with size based on count
                const radius = Math.sqrt(location.count) * 500;
                const circle = L.circle([location.lat, location.lng], {
                    color: '#1a237e',
                    fillColor: '#4a148c',
                    fillOpacity: 0.5,
                    radius: radius
                }).addTo(heatMap);
                
                // Add popup
                circle.bindPopup(`
                    <b>${location.title}</b><br>
                    Souls Reached: ${location.count}<br>
                    <small>Click for details</small>
                `);
            });
            
            // Fit bounds to show all markers
            const bounds = L.latLngBounds(locations.map(loc => [loc.lat, loc.lng]));
            heatMap.fitBounds(bounds, { padding: [50, 50] });
        }

        function updateHeatMap() {
            // Refresh heat map data
            if (heatMap) {
                heatMap.eachLayer(layer => {
                    if (layer instanceof L.Circle) {
                        heatMap.removeLayer(layer);
                    }
                });
                
                // Re-add markers with updated data
                // In a real app, this would fetch new data
                initHeatMap();
            }
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        function updateOnlineStatus() {
            appState.isOnline = navigator.onLine;
            
            if (appState.isOnline) {
                offlineIndicator.style.display = 'none';
                syncStatus.innerHTML = '<i class="fas fa-cloud" style="color: var(--success);"></i><span>All systems synced</span>';
                
                // Sync offline data if any
                if (appState.offlineData.length > 0) {
                    syncOfflineData();
                }
            } else {
                offlineIndicator.style.display = 'flex';
                syncStatus.innerHTML = '<i class="fas fa-cloud-slash" style="color: var(--warning);"></i><span>Working offline</span>';
            }
        }

        function storeOfflineData(data) {
            appState.offlineData.push(data);
            localStorage.setItem('offlineEvangelismData', JSON.stringify(appState.offlineData));
            showAlert('Report saved offline. It will sync when you are back online.', 'info', formAlert);
        }

        function syncOfflineData() {
            // In a real app, this would send data to Firebase
            if (appState.offlineData.length > 0) {
                showAlert(`${appState.offlineData.length} offline report(s) synced successfully.`, 'success', formAlert);
                appState.offlineData = [];
                localStorage.removeItem('offlineEvangelismData');
                appState.lastSync = new Date().toISOString();
                
                // Update dashboard
                updateDashboard();
            }
        }

        function updateSyncStatus() {
            if (appState.lastSync) {
                const lastSyncDate = new Date(appState.lastSync);
                const now = new Date();
                const diffMinutes = Math.floor((now - lastSyncDate) / (1000 * 60));
                
                if (diffMinutes < 5) {
                    syncStatus.innerHTML = '<i class="fas fa-cloud" style="color: var(--success);"></i><span>Recently synced</span>';
                } else {
                    syncStatus.innerHTML = `<i class="fas fa-cloud" style="color: var(--warning);"></i><span>Last sync: ${diffMinutes} min ago</span>`;
                }
            }
        }

        function uploadTestimony(file) {
            // Simulate file upload
            showAlert(`Uploading ${file.name}...`, 'info', formAlert);
            
            setTimeout(() => {
                const testimonyDiv = document.createElement('div');
                testimonyDiv.className = 'alert alert-success';
                testimonyDiv.style.marginBottom = '10px';
                testimonyDiv.innerHTML = `
                    <i class="fas fa-file-audio"></i>
                    <div style="flex: 1;">
                        <strong>${file.name}</strong><br>
                        <small>Uploaded successfully</small>
                    </div>
                    <button class="btn btn-sm btn-secondary" onclick="this.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                uploadedTestimonies.appendChild(testimonyDiv);
                showAlert('Testimony uploaded successfully.', 'success', formAlert);
                
                // Log audit
                logAudit('UPLOAD', 'Testimony', `Uploaded testimony: ${file.name}`);
            }, 1500);
        }

        function exportConvertsToExcel() {
            // Create workbook
            const wb = XLSX.utils.book_new();
            
            // Create converts sheet
            const convertsData = mockData.converts.map(convert => ({
                'Name': convert.name,
                'Phone Number': convert.phone,
                'WhatsApp': convert.whatsapp ? 'Yes' : 'No',
                'Date Saved': convert.date,
                'Age Range': convert.age,
                'Gender': convert.gender,
                'Address': convert.address,
                'Status': convert.status,
                'Follow-up Worker': convert.followUpWorker,
                'Prayer Needs': convert.prayerNeeds,
                'Needs Counseling': convert.counseling ? 'Yes' : 'No',
                'Lifecycle Stage': convert.lifecycle
            }));
            
            const ws = XLSX.utils.json_to_sheet(convertsData);
            XLSX.utils.book_append_sheet(wb, ws, 'Converts');
            
            // Generate and download
            XLSX.writeFile(wb, 'converts-export.xlsx');
            
            showAlert('Converts exported to Excel successfully.', 'success', formAlert);
            
            // Log audit
            logAudit('EXPORT', 'Converts', 'Exported converts data to Excel');
        }

        function exportAuditLogs() {
            // Create CSV content
            let csv = 'Timestamp,User,Action,Entity,Details,IP Address\n';
            
            mockData.auditLogs.forEach(log => {
                csv += `"${log.timestamp}","${log.user}","${log.action}","${log.entity}","${log.details}","${log.ip}"\n`;
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'audit-logs.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            
            showAlert('Audit logs exported successfully.', 'success', reportAlert);
            
            // Log audit
            logAudit('EXPORT', 'Audit Logs', 'Exported audit logs');
        }

        function logAudit(action, entity, details) {
            const log = {
                id: mockData.auditLogs.length + 1,
                timestamp: new Date().toISOString().replace('T', ' ').substring(0, 19),
                user: appState.currentUser ? appState.currentUser.name : 'System',
                action: action,
                entity: entity,
                details: details,
                ip: '192.168.1.' + Math.floor(Math.random() * 255) // Simulated IP
            };
            
            mockData.auditLogs.unshift(log);
            
            // Update audit logs page if currently viewing it
            if (appState.currentPage === 'audit') {
                loadAuditLogs();
            }
        }

        // ============================================
        // DEMO FUNCTIONS (for UI interactions)
        // ============================================
        // These functions are called from onclick handlers in the UI

        window.viewReport = function(reportId) {
            const report = mockData.reports.find(r => r.id === reportId);
            if (report) {
                alert(`Report Details:\n\nDate: ${formatDate(report.date)}\nEvangelist: ${report.evangelist}\nLocation: ${report.location}\nType: ${report.type}\nSouls Reached: ${report.souls}\nDecisions: ${report.decisions}\nStatus: ${report.status}\n\nNotes: ${report.notes}`);
            }
        };

        window.viewConvert = function(convertId) {
            const convert = mockData.converts.find(c => c.id === convertId);
            if (convert) {
                alert(`Convert Details:\n\nName: ${convert.name}\nPhone: ${convert.phone} ${convert.whatsapp ? '(WhatsApp)' : ''}\nDate Saved: ${formatDate(convert.date)}\nAge/Gender: ${convert.age}/${convert.gender}\nAddress: ${convert.address}\nStatus: ${convert.status}\nFollow-up Worker: ${convert.followUpWorker}\nPrayer Needs: ${convert.prayerNeeds}\nCounseling Needed: ${convert.counseling ? 'Yes' : 'No'}`);
            }
        };

        window.scheduleFollowupForConvert = function(convertId) {
            const convert = mockData.converts.find(c => c.id === convertId);
            if (convert) {
                showAlert(`Follow-up scheduled for ${convert.name}. They will be contacted within 24 hours.`, 'success', formAlert);
                
                // Log audit
                logAudit('CREATE', 'Follow-up', `Scheduled follow-up for ${convert.name}`);
            }
        };

        window.contactConvert = function(convertId) {
            const convert = mockData.converts.find(c => c.id === convertId);
            if (convert) {
                showAlert(`Calling ${convert.name} at ${convert.phone}...`, 'info', formAlert);
                
                // Simulate updating status after contact
                setTimeout(() => {
                    convert.status = 'Contacted';
                    showAlert(`Successfully contacted ${convert.name}. Status updated.`, 'success', formAlert);
                    loadConvertsData();
                    
                    // Log audit
                    logAudit('UPDATE', 'Convert', `Contacted ${convert.name}, status updated to Contacted`);
                }, 2000);
            }
        };

        window.completeFollowup = function(followupId) {
            const followup = mockData.followUps.find(f => f.id === followupId);
            if (followup) {
                followup.status = 'Completed';
                showAlert(`Follow-up marked as completed for ${followup.convertName}.`, 'success', formAlert);
                loadFollowupsData();
                
                // Log audit
                logAudit('UPDATE', 'Follow-up', `Marked follow-up as completed for ${followup.convertName}`);
            }
        };

        window.rescheduleFollowup = function(followupId) {
            const followup = mockData.followUps.find(f => f.id === followupId);
            if (followup) {
                const newDate = new Date();
                newDate.setDate(newDate.getDate() + 3);
                followup.date = newDate.toISOString().split('T')[0];
                followup.status = 'Upcoming';
                showAlert(`Follow-up rescheduled to ${formatDate(followup.date)} for ${followup.convertName}.`, 'success', formAlert);
                loadFollowupsData();
                
                // Log audit
                logAudit('UPDATE', 'Follow-up', `Rescheduled follow-up for ${followup.convertName} to ${followup.date}`);
            }
        };

        // ============================================
        // INITIALIZE APPLICATION
        // ============================================
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
